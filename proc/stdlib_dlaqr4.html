<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="A community driven standard library for (modern) Fortran">
    <meta name="author" content="fortran-lang/stdlib contributors" >
    <link rel="icon" href="../favicon.png">

    <title>stdlib_dlaqr4 &ndash; Fortran-lang/stdlib</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran-lang/stdlib </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href='../page/index.html'>Contributing and specs</a></li>
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>stdlib_dlaqr4
      <small>Subroutine</small>
    </h1>
    <div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
    <li><i class="fa fa-legal"></i> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a></li> 
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 0.1% of total for procedures.">199 statements</a>
     </li> 
    <li><i class="fa fa-code"></i><a href="../src/stdlib_linalg_lapack_d.fypp"> Source File</a></li>
  </ul>
  <ol class="breadcrumb in-well text-right">
     <li><a href='../sourcefile/stdlib_linalg_lapack_d.fypp.html'>stdlib_linalg_lapack_d.fypp</a></li>
     <li><a href='../module/stdlib_linalg_lapack_d.html'>stdlib_linalg_lapack_d</a></li>
     <li class="active">stdlib_dlaqr4</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    <div id="sidebar">
  <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/stdlib_dlaqr4.html#src">stdlib_dlaqr4</a>
  </div>
</div>

</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public subroutine stdlib_dlaqr4(wantt, wantz, n, ilo, ihi, h, ldh, wr, wi, iloz, ihiz, z, ldz, work, lwork, info)</h2>
    

    <p>DLAQR4 implements one level of recursion for DLAQR0.
It is a complete implementation of the small bulge multi-shift
QR algorithm.  It may be called by DLAQR0 and, for large enough
deflation window size, it may be called by DLAQR3.  This
subroutine is identical to DLAQR0 except that it calls DLAQR2
instead of DLAQR3.
DLAQR4 computes the eigenvalues of a Hessenberg matrix H
and, optionally, the matrices T and Z from the Schur decomposition
H = Z T Z<strong>T, where T is an upper quasi-triangular matrix (the
Schur form), and Z is the orthogonal matrix of Schur vectors.
Optionally Z may be postmultiplied into an input orthogonal
matrix Q so that this routine can give the Schur factorization
of a matrix A which has been reduced to the Hessenberg form H
by the orthogonal matrix Q:  A = Q<em>H</em>Q</strong>T = (QZ)<em>T</em>(QZ)**T.</p>

    <h3>Arguments</h3>
      <table class="table table-striped varlist">
<thead><tr><th>Type</th><th>Intent</th><th>Optional</th><th>Attributes</th><th></th><th>Name</th><th></th></thead>
<tbody>
<tr>
  <td><span class="anchor" id="variable-wantt~17"></span>logical(kind=lk),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>wantt</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-wantz~27"></span>logical(kind=lk),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>wantz</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-n~1100"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>n</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ilo~56"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ilo</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ihi~58"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ihi</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-h~36"></span>real(kind=dp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>h</strong>(ldh,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ldh~36"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ldh</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-wr~11"></span>real(kind=dp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>wr</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-wi~12"></span>real(kind=dp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>wi</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-iloz~17"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>iloz</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ihiz~17"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ihiz</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-z~108"></span>real(kind=dp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>z</strong>(ldz,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ldz~89"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ldz</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-work~613"></span>real(kind=dp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>work</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-lwork~299"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>lwork</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-info~825"></span>integer(kind=ilp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>info</strong></td><td></td>
</tr>
</tbody>
</table>

    <br>

    <section class="visible-xs visible-sm hidden-md">
      <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/stdlib_dlaqr4.html#src">stdlib_dlaqr4</a>
  </div>
</div>

    </section>
    <br class="visible-xs visible-sm hidden-md">


    
    

    
    


    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="w">     </span><span class="k">subroutine </span><span class="n">stdlib_dlaqr4</span><span class="p">(</span><span class="w"> </span><span class="n">wantt</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="p">,</span><span class="w"> </span><span class="n">wi</span><span class="p">,</span><span class="n">iloz</span><span class="p">,</span><span class="w"> </span><span class="n">ihiz</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,&amp;</span>
<span class="w">     </span><span class="c">!! DLAQR4 implements one level of recursion for DLAQR0.</span>
<span class="w">     </span><span class="c">!! It is a complete implementation of the small bulge multi-shift</span>
<span class="w">     </span><span class="c">!! QR algorithm.  It may be called by DLAQR0 and, for large enough</span>
<span class="w">     </span><span class="c">!! deflation window size, it may be called by DLAQR3.  This</span>
<span class="w">     </span><span class="c">!! subroutine is identical to DLAQR0 except that it calls DLAQR2</span>
<span class="w">     </span><span class="c">!! instead of DLAQR3.</span>
<span class="w">     </span><span class="c">!! DLAQR4 computes the eigenvalues of a Hessenberg matrix H</span>
<span class="w">     </span><span class="c">!! and, optionally, the matrices T and Z from the Schur decomposition</span>
<span class="w">     </span><span class="c">!! H = Z T Z**T, where T is an upper quasi-triangular matrix (the</span>
<span class="w">     </span><span class="c">!! Schur form), and Z is the orthogonal matrix of Schur vectors.</span>
<span class="w">     </span><span class="c">!! Optionally Z may be postmultiplied into an input orthogonal</span>
<span class="w">     </span><span class="c">!! matrix Q so that this routine can give the Schur factorization</span>
<span class="w">     </span><span class="c">!! of a matrix A which has been reduced to the Hessenberg form H</span>
<span class="w">     </span><span class="c">!! by the orthogonal matrix Q:  A = Q*H*Q**T = (QZ)*T*(QZ)**T.</span>
<span class="w">                </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="c">! -- lapack auxiliary routine --</span>
<span class="w">        </span><span class="c">! -- lapack is a software package provided by univ. of tennessee,    --</span>
<span class="w">        </span><span class="c">! -- univ. of california berkeley, univ. of colorado denver and nag ltd..--</span>
<span class="w">           </span><span class="c">! Scalar Arguments </span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">ihiz</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">iloz</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">info</span>
<span class="w">           </span><span class="kt">logical</span><span class="p">(</span><span class="n">lk</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wantt</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span>
<span class="w">           </span><span class="c">! Array Arguments </span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="n">ldh</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">z</span><span class="p">(</span><span class="n">ldz</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="w">        </span><span class="c">! ================================================================</span>
<span class="w">           </span><span class="c">! Parameters </span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ntiny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">15</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">kexnw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">5</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">kexsh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">6</span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wilk1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.75_dp</span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">),</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wilk2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">0.4375_dp</span>
<span class="w">           </span><span class="c">! ==== matrices of order ntiny or smaller must be processed by</span>
<span class="w">           </span><span class="c">! .    stdlib_dlahqr because of insufficient subdiagonal scratch space.</span>
<span class="w">           </span><span class="c">! .    (this is a hard limit.) ====</span>
<span class="w">           </span>
<span class="w">           </span><span class="c">! ==== exceptional deflation windows:  try to cure rare</span>
<span class="w">           </span><span class="c">! .    slow convergence by varying the size of the</span>
<span class="w">           </span><span class="c">! .    deflation window after kexnw iterations. ====</span>
<span class="w">           </span>
<span class="w">           </span><span class="c">! ==== exceptional shifts: try to cure rare slow convergence</span>
<span class="w">           </span><span class="c">! .    with ad-hoc exceptional shifts every kexsh iterations.</span>
<span class="w">           </span><span class="c">! .    ====</span>
<span class="w">           </span>
<span class="w">           </span><span class="c">! ==== the constants wilk1 and wilk2 are used to form the</span>
<span class="w">           </span><span class="c">! .    exceptional shifts. ====</span>
<span class="w">           </span>
<span class="w">           </span>
<span class="w">           </span><span class="c">! Local Scalars </span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">bb</span><span class="p">,</span><span class="w"> </span><span class="n">cc</span><span class="p">,</span><span class="w"> </span><span class="n">cs</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">,</span><span class="w"> </span><span class="n">sn</span><span class="p">,</span><span class="w"> </span><span class="n">ss</span><span class="p">,</span><span class="w"> </span><span class="n">swap</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">inf</span><span class="p">,</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">itmax</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">kacc22</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">kdu</span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="p">,</span><span class="w"> </span><span class="n">kt</span><span class="p">,</span><span class="w"> </span><span class="n">ktop</span><span class="p">,</span><span class="w"> </span><span class="n">ku</span><span class="p">,</span><span class="w"> </span><span class="n">kv</span><span class="p">,</span><span class="w"> </span><span class="n">kwh</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">           </span><span class="n">kwtop</span><span class="p">,</span><span class="w"> </span><span class="n">kwv</span><span class="p">,</span><span class="w"> </span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">ls</span><span class="p">,</span><span class="w"> </span><span class="n">lwkopt</span><span class="p">,</span><span class="w"> </span><span class="n">ndec</span><span class="p">,</span><span class="w"> </span><span class="n">ndfl</span><span class="p">,</span><span class="w"> </span><span class="n">nh</span><span class="p">,</span><span class="w"> </span><span class="n">nho</span><span class="p">,</span><span class="w"> </span><span class="n">nibble</span><span class="p">,</span><span class="w"> </span><span class="n">nmin</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">nsmax</span><span class="p">,</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="n">nve</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,&amp;</span>
<span class="w">                      </span><span class="n">nwmax</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="p">,</span><span class="w"> </span><span class="n">nwupbd</span>
<span class="w">           </span><span class="kt">logical</span><span class="p">(</span><span class="n">lk</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sorted</span>
<span class="w">           </span><span class="kt">character</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jbcmpz</span><span class="o">*</span><span class="mi">2</span>
<span class="w">           </span><span class="c">! Local Arrays </span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">dp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">zdum</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="w">           </span><span class="c">! Intrinsic Functions </span>
<span class="w">           </span><span class="k">intrinsic</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="nb">abs</span><span class="p">,</span><span class="kt">real</span><span class="p">,</span><span class="nb">int</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span><span class="nb">min</span><span class="p">,</span><span class="nb">mod</span>
<span class="w">           </span><span class="c">! Executable Statements </span>
<span class="w">           </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="c">! ==== quick return for n = 0: nothing to do. ====</span>
<span class="w">           </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           end if</span>
<span class="k">           if</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">&lt;=</span><span class="n">ntiny</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! ==== tiny matrices must use stdlib_dlahqr. ====</span>
<span class="w">              </span><span class="n">lwkopt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">              </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">lwork</span><span class="o">/=-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_dlahqr</span><span class="p">(</span><span class="w"> </span><span class="n">wantt</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="p">,</span><span class="w"> </span><span class="n">wi</span><span class="p">,</span><span class="n">iloz</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">ihiz</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">else</span>
<span class="w">              </span><span class="c">! ==== use small bulge multi-shift qr with aggressive early</span>
<span class="w">              </span><span class="c">! .    deflation on larger-than-tiny matrices. ====</span>
<span class="w">              </span><span class="c">! ==== hope for the best. ====</span>
<span class="w">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="c">! ==== set up job flags for stdlib_ilaenv. ====</span>
<span class="w">              </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">wantt</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">jbcmpz</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;S&#39;</span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                 </span><span class="n">jbcmpz</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;E&#39;</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="p">(</span><span class="w"> </span><span class="n">wantz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">jbcmpz</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;V&#39;</span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                 </span><span class="n">jbcmpz</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;N&#39;</span>
<span class="w">              </span><span class="k">end if</span>
<span class="w">              </span><span class="c">! ==== nwr = recommended deflation window size.  at this</span>
<span class="w">              </span><span class="c">! .    point,  n &gt; ntiny = 15, so there is enough</span>
<span class="w">              </span><span class="c">! .    subdiagonal workspace for nwr&gt;=2 as required.</span>
<span class="w">              </span><span class="c">! .    (in fact, there is enough subdiagonal space for</span>
<span class="w">              </span><span class="c">! .    nwr&gt;=4.) ====</span>
<span class="w">              </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">ihi</span><span class="o">-</span><span class="n">ilo</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== nsr = recommended number of simultaneous shifts.</span>
<span class="w">              </span><span class="c">! .    at this point n &gt; ntiny = 15, so there is at</span>
<span class="w">              </span><span class="c">! .    enough subdiagonal workspace for nsr to be even</span>
<span class="w">              </span><span class="c">! .    and greater than or equal to two as required. ====</span>
<span class="w">              </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="o">-</span><span class="n">ilo</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nsr</span><span class="o">-</span><span class="nb">mod</span><span class="p">(</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== estimate optimal workspace ====</span>
<span class="w">              </span><span class="c">! ==== workspace query call to stdlib_dlaqr2 ====</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_dlaqr2</span><span class="p">(</span><span class="w"> </span><span class="n">wantt</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">iloz</span><span class="p">,</span><span class="n">ihiz</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">ls</span><span class="p">,&amp;</span>
<span class="w">                         </span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="p">,</span><span class="w"> </span><span class="n">wi</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== optimal workspace = max(stdlib_dlaqr5, stdlib_dlaqr2) ====</span>
<span class="w">              </span><span class="n">lwkopt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">3</span><span class="o">*</span><span class="n">nsr</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== quick return in case of workspace query. ====</span>
<span class="w">              </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">lwork</span><span class="o">==-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">lwkopt</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">dp</span><span class="p">)</span>
<span class="w">                 </span><span class="k">return</span>
<span class="k">              end if</span>
<span class="w">              </span><span class="c">! ==== stdlib_dlahqr/stdlib_dlaqr0 crossover point ====</span>
<span class="w">              </span><span class="n">nmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">ntiny</span><span class="p">,</span><span class="w"> </span><span class="n">nmin</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== nibble crossover point ====</span>
<span class="w">              </span><span class="n">nibble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nibble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">nibble</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== accumulate reflections during ttswp?  use block</span>
<span class="w">              </span><span class="c">! .    2-by-2 structure during matrix-matrix multiply? ====</span>
<span class="w">              </span><span class="n">kacc22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;DLAQR4&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">kacc22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">kacc22</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">kacc22</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">kacc22</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== nwmax = the largest possible deflation window for</span>
<span class="w">              </span><span class="c">! .    which there is sufficient workspace. ====</span>
<span class="w">              </span><span class="n">nwmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nwmax</span>
<span class="w">              </span><span class="c">! ==== nsmax = the largest number of simultaneous shifts</span>
<span class="w">              </span><span class="c">! .    for which there is sufficient workspace. ====</span>
<span class="w">              </span><span class="n">nsmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">6</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">lwork</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">nsmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nsmax</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="w"> </span><span class="n">nsmax</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== ndfl: an iteration count restarted at deflation. ====</span>
<span class="w">              </span><span class="n">ndfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">              </span><span class="c">! ==== itmax = iteration limit ====</span>
<span class="w">              </span><span class="n">itmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">kexsh</span><span class="w"> </span><span class="p">)</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ihi</span><span class="o">-</span><span class="n">ilo</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! ==== last row and column in the active block ====</span>
<span class="w">              </span><span class="n">kbot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ihi</span>
<span class="w">              </span><span class="c">! ==== main loop ====</span>
<span class="w">              </span><span class="n">loop_80</span><span class="p">:</span><span class="w"> </span><span class="k">do </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">itmax</span>
<span class="w">                 </span><span class="c">! ==== done when kbot falls below ilo ====</span>
<span class="w">                 </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">&lt;</span><span class="n">ilo</span><span class="w"> </span><span class="p">)</span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">90</span>
<span class="w">                 </span><span class="c">! ==== locate active block ====</span>
<span class="w">                 </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="o">==</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">20</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilo</span>
<span class="w">                 </span><span class="mi">20</span><span class="w"> </span><span class="k">continue</span>
<span class="k">                 </span><span class="n">ktop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span>
<span class="w">                 </span><span class="c">! ==== select deflation window size:</span>
<span class="w">                 </span><span class="c">! .    typical case:</span>
<span class="w">                 </span><span class="c">! .      if possible and advisable, nibble the entire</span>
<span class="w">                 </span><span class="c">! .      active block.  if not, use size min(nwr,nwmax)</span>
<span class="w">                 </span><span class="c">! .      or min(nwr+1,nwmax) depending upon which has</span>
<span class="w">                 </span><span class="c">! .      the smaller corresponding subdiagonal entry</span>
<span class="w">                 </span><span class="c">! .      (a heuristic).</span>
<span class="w">                 </span><span class="c">! .    exceptional case:</span>
<span class="w">                 </span><span class="c">! .      if there have been no deflations in kexnw or</span>
<span class="w">                 </span><span class="c">! .      more iterations, then vary the deflation window</span>
<span class="w">                 </span><span class="c">! .      size.   at first, because, larger windows are,</span>
<span class="w">                 </span><span class="c">! .      in general, more powerful than smaller ones,</span>
<span class="w">                 </span><span class="c">! .      rapidly increase the window to the maximum possible.</span>
<span class="w">                 </span><span class="c">! .      then, gradually reduce the window size. ====</span>
<span class="w">                 </span><span class="n">nh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ktop</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="n">nwupbd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nh</span><span class="p">,</span><span class="w"> </span><span class="n">nwmax</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ndfl</span><span class="o">&lt;</span><span class="n">kexnw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nwupbd</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">else</span>
<span class="k">                    </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nwupbd</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">                 if</span><span class="p">(</span><span class="w"> </span><span class="n">nw</span><span class="o">&lt;</span><span class="n">nwmax</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    if</span><span class="p">(</span><span class="w"> </span><span class="n">nw</span><span class="o">&gt;=</span><span class="n">nh</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nh</span>
<span class="w">                    </span><span class="k">else</span>
<span class="k">                       </span><span class="n">kwtop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                       </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kwtop</span><span class="p">,</span><span class="w"> </span><span class="n">kwtop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">&gt;</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kwtop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">kwtop</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="mi">1</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                 end if</span>
<span class="k">                 if</span><span class="p">(</span><span class="w"> </span><span class="n">ndfl</span><span class="o">&lt;</span><span class="n">kexnw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">ndec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">                 </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">ndec</span><span class="o">&gt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">nw</span><span class="o">&gt;=</span><span class="n">nwupbd</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">ndec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndec</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">nw</span><span class="o">-</span><span class="n">ndec</span><span class="o">&lt;</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="n">ndec</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                    </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ndec</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="w">                 </span><span class="c">! ==== aggressive early deflation:</span>
<span class="w">                 </span><span class="c">! .    split workspace under the subdiagonal into</span>
<span class="w">                 </span><span class="c">! .      - an nw-by-nw work array v in the lower</span>
<span class="w">                 </span><span class="c">! .        left-hand-corner,</span>
<span class="w">                 </span><span class="c">! .      - an nw-by-at-least-nw-but-more-is-better</span>
<span class="w">                 </span><span class="c">! .        (nw-by-nho) horizontal work array along</span>
<span class="w">                 </span><span class="c">! .        the bottom edge,</span>
<span class="w">                 </span><span class="c">! .      - an at-least-nw-but-more-is-better (nhv-by-nw)</span>
<span class="w">                 </span><span class="c">! .        vertical work array along the left-hand-edge.</span>
<span class="w">                 </span><span class="c">! .        ====</span>
<span class="w">                 </span><span class="n">kv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="n">kt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="n">nho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">nw</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="n">kwv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nw</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span>
<span class="w">                 </span><span class="n">nve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">nw</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kwv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="c">! ==== aggressive early deflation ====</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_dlaqr2</span><span class="p">(</span><span class="w"> </span><span class="n">wantt</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ktop</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">iloz</span><span class="p">,</span><span class="n">ihiz</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                 </span><span class="n">ls</span><span class="p">,</span><span class="w"> </span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="p">,</span><span class="w"> </span><span class="n">wi</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kv</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="n">nho</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kv</span><span class="p">,</span><span class="w"> </span><span class="n">kt</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">nve</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kwv</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="p">,&amp;</span>
<span class="w">                           </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="c">! ==== adjust kbot accounting for new deflations. ====</span>
<span class="w">                 </span><span class="n">kbot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ld</span>
<span class="w">                 </span><span class="c">! ==== ks points to the shifts. ====</span>
<span class="w">                 </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="c">! ==== skip an expensive qr sweep if there is a (partly</span>
<span class="w">                 </span><span class="c">! .    heuristic) reason to expect that many eigenvalues</span>
<span class="w">                 </span><span class="c">! .    will deflate without it.  here, the qr sweep is</span>
<span class="w">                 </span><span class="c">! .    skipped if many eigenvalues have just been deflated</span>
<span class="w">                 </span><span class="c">! .    or if the remaining active block is small.</span>
<span class="w">                 </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ld</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">100</span><span class="o">*</span><span class="n">ld</span><span class="o">&lt;=</span><span class="n">nw</span><span class="o">*</span><span class="n">nibble</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ktop</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;</span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nmin</span><span class="p">,</span><span class="w"> </span><span class="n">nwmax</span><span class="w"> </span><span class="p">)&amp;</span>
<span class="w">                            </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! ==== ns = nominal number of simultaneous shifts.</span>
<span class="w">                    </span><span class="c">! .    this may be lowered (slightly) if stdlib_dlaqr2</span>
<span class="w">                    </span><span class="c">! .    did not provide that many shifts. ====</span>
<span class="w">                    </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nsmax</span><span class="p">,</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ktop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="c">! ==== if there have been no deflations</span>
<span class="w">                    </span><span class="c">! .    in a multiple of kexsh iterations,</span>
<span class="w">                    </span><span class="c">! .    then try exceptional shifts.</span>
<span class="w">                    </span><span class="c">! .    otherwise use shifts provided by</span>
<span class="w">                    </span><span class="c">! .    stdlib_dlaqr2 above or from the eigenvalues</span>
<span class="w">                    </span><span class="c">! .    of a trailing principal submatrix. ====</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="w"> </span><span class="n">ndfl</span><span class="p">,</span><span class="w"> </span><span class="n">kexsh</span><span class="w"> </span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                       </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ktop</span><span class="o">+</span><span class="mi">2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">                          </span><span class="n">ss</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wilk1</span><span class="o">*</span><span class="n">ss</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="n">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ss</span>
<span class="w">                          </span><span class="n">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wilk2</span><span class="o">*</span><span class="n">ss</span>
<span class="w">                          </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aa</span>
<span class="w">                          </span><span class="k">call </span><span class="n">stdlib_dlanv2</span><span class="p">(</span><span class="w"> </span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">bb</span><span class="p">,</span><span class="w"> </span><span class="n">cc</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="p">),</span><span class="w"> </span><span class="n">cs</span><span class="p">,</span><span class="w"> </span><span class="n">sn</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                       if</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">==</span><span class="n">ktop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                          </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                          </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">end if</span>
<span class="k">                    else</span>
<span class="w">                       </span><span class="c">! ==== got ns/2 or fewer shifts? use stdlib_dlahqr</span>
<span class="w">                       </span><span class="c">! .    on a trailing principal submatrix to</span>
<span class="w">                       </span><span class="c">! .    get more. (since ns&lt;=nsmax&lt;=(n-3)/6,</span>
<span class="w">                       </span><span class="c">! .    there is enough space below the subdiagonal</span>
<span class="w">                       </span><span class="c">! .    to fit an ns-by-ns scratch array.) ====</span>
<span class="w">                       </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="o">&lt;=</span><span class="n">ns</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                          </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                          </span><span class="n">kt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                          </span><span class="k">call </span><span class="n">stdlib_dlacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kt</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="w"> </span><span class="p">)</span>
<span class="w">                                    </span>
<span class="w">                          </span><span class="k">call </span><span class="n">stdlib_dlahqr</span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kt</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="p">),</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zdum</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">inf</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">inf</span>
<span class="w">                          </span><span class="c">! ==== in case of a rare qr failure use</span>
<span class="w">                          </span><span class="c">! .    eigenvalues of the trailing 2-by-2</span>
<span class="w">                          </span><span class="c">! .    principal submatrix.  ====</span>
<span class="w">                          </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="o">&gt;=</span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                             </span><span class="n">aa</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">cc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">bb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">dd</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="k">call </span><span class="n">stdlib_dlanv2</span><span class="p">(</span><span class="w"> </span><span class="n">aa</span><span class="p">,</span><span class="w"> </span><span class="n">bb</span><span class="p">,</span><span class="w"> </span><span class="n">cc</span><span class="p">,</span><span class="w"> </span><span class="n">dd</span><span class="p">,</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                       </span><span class="n">kbot</span><span class="w"> </span><span class="p">),</span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">cs</span><span class="p">,</span><span class="w"> </span><span class="n">sn</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                          </span><span class="k">end if</span>
<span class="k">                       end if</span>
<span class="k">                       if</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;</span><span class="n">ns</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                          </span><span class="c">! ==== sort the shifts (helps a little)</span>
<span class="w">                          </span><span class="c">! .    bubble sort keeps complex conjugate</span>
<span class="w">                          </span><span class="c">! .    pairs together. ====</span>
<span class="w">                          </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                          </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">                             </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">sorted</span><span class="w"> </span><span class="p">)</span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">60</span>
<span class="w">                             </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">                             </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ks</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                                </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                          </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                                   </span><span class="n">sorted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                                   </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span>
<span class="w">                                   </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                                   </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span>
<span class="w">                                   </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span>
<span class="w">                                   </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                                   </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span>
<span class="w">                                </span><span class="k">end if</span>
<span class="k">                             end do</span>
<span class="k">                          end do</span>
<span class="k">                          </span><span class="mi">60</span><span class="w"> </span><span class="k">continue</span>
<span class="k">                       end if</span>
<span class="w">                       </span><span class="c">! ==== shuffle shifts into pairs of real shifts</span>
<span class="w">                       </span><span class="c">! .    and pairs of complex conjugate shifts</span>
<span class="w">                       </span><span class="c">! .    assuming complex conjugate shifts are</span>
<span class="w">                       </span><span class="c">! .    already adjacent to one another. (yes,</span>
<span class="w">                       </span><span class="c">! .    they are.)  ====</span>
<span class="w">                       </span><span class="k">do </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">                          </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="o">/=-</span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                             </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span>
<span class="w">                             </span><span class="n">swap</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">                             </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">swap</span>
<span class="w">                          </span><span class="k">end if</span>
<span class="k">                       end do</span>
<span class="k">                    end if</span>
<span class="w">                    </span><span class="c">! ==== if there are only two shifts and both are</span>
<span class="w">                    </span><span class="c">! .    real, then use only one.  ====</span>
<span class="w">                    </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="o">==</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       if</span><span class="p">(</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span><span class="o">==</span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                          if</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span><span class="o">-</span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="o">-</span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                             </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">else</span>
<span class="k">                             </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">end if</span>
<span class="k">                       end if</span>
<span class="k">                    end if</span>
<span class="w">                    </span><span class="c">! ==== use up to ns of the the smallest magnitude</span>
<span class="w">                    </span><span class="c">! .    shifts.  if there aren&#39;t ns shifts available,</span>
<span class="w">                    </span><span class="c">! .    then use them all, possibly dropping one to</span>
<span class="w">                    </span><span class="c">! .    make the number of shifts even. ====</span>
<span class="w">                    </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="o">-</span><span class="n">ks</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">ks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ns</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="c">! ==== small-bulge multi-shift qr sweep:</span>
<span class="w">                    </span><span class="c">! .    split workspace under the subdiagonal into</span>
<span class="w">                    </span><span class="c">! .    - a kdu-by-kdu work array u in the lower</span>
<span class="w">                    </span><span class="c">! .      left-hand-corner,</span>
<span class="w">                    </span><span class="c">! .    - a kdu-by-at-least-kdu-but-more-is-better</span>
<span class="w">                    </span><span class="c">! .      (kdu-by-nho) horizontal work array wh along</span>
<span class="w">                    </span><span class="c">! .      the bottom edge,</span>
<span class="w">                    </span><span class="c">! .    - and an at-least-kdu-but-more-is-better-by-kdu</span>
<span class="w">                    </span><span class="c">! .      (nve-by-kdu) vertical work wv arrow along</span>
<span class="w">                    </span><span class="c">! .      the left-hand-edge. ====</span>
<span class="w">                    </span><span class="n">kdu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">ns</span>
<span class="w">                    </span><span class="n">ku</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="n">kwh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="n">nho</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">kdu</span><span class="o">+</span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">kdu</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="n">kwv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">4</span>
<span class="w">                    </span><span class="n">nve</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kdu</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">kwv</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="c">! ==== small-bulge multi-shift qr sweep ====</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_dlaqr5</span><span class="p">(</span><span class="w"> </span><span class="n">wantt</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">kacc22</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ktop</span><span class="p">,</span><span class="w"> </span><span class="n">kbot</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="n">wr</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">wi</span><span class="p">(</span><span class="w"> </span><span class="n">ks</span><span class="w"> </span><span class="p">)&amp;</span>
<span class="w">                    </span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">iloz</span><span class="p">,</span><span class="w"> </span><span class="n">ihiz</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">ku</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="n">nve</span><span class="p">,</span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">kwv</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">nho</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">(</span><span class="w"> </span><span class="n">ku</span><span class="p">,</span><span class="w"> </span><span class="n">kwh</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldh</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="w">                 </span><span class="c">! ==== note progress (or the lack of it). ====</span>
<span class="w">                 </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ld</span><span class="o">&gt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">ndfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="k">else</span>
<span class="k">                    </span><span class="n">ndfl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ndfl</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="w">                 </span><span class="c">! ==== end of main loop ====</span>
<span class="w">              </span><span class="k">end do </span><span class="n">loop_80</span>
<span class="w">              </span><span class="c">! ==== iteration limit exceeded.  set info to show where</span>
<span class="w">              </span><span class="c">! .    the problem occurred and exit. ====</span>
<span class="w">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">kbot</span>
<span class="w">              </span><span class="mi">90</span><span class="w"> </span><span class="k">continue</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! ==== return the optimal value of lwork. ====</span>
<span class="w">           </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">lwkopt</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">dp</span><span class="p">)</span>
<span class="w">     </span><span class="k">end subroutine </span><span class="n">stdlib_dlaqr4</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>Fortran-lang/stdlib was developed by fortran-lang/stdlib contributors<br>&copy; 2024 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
<br /><small>df45374</small></p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2024-04-06 10:42            </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>