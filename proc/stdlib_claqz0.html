<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="A community driven standard library for (modern) Fortran">
    <meta name="author" content="fortran-lang/stdlib contributors" >
    <link rel="icon" href="../favicon.png">

    <title>stdlib_claqz0 &ndash; Fortran-lang/stdlib</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran-lang/stdlib </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href='../page/index.html'>Contributing and specs</a></li>
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>stdlib_claqz0
      <small>Subroutine</small>
    </h1>
    <div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
    <li><i class="fa fa-legal"></i> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a></li> 
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 0.1% of total for procedures.">248 statements</a>
     </li> 
    <li><i class="fa fa-code"></i><a href="../src/stdlib_linalg_lapack_c.fypp"> Source File</a></li>
  </ul>
  <ol class="breadcrumb in-well text-right">
     <li><a href='../sourcefile/stdlib_linalg_lapack_c.fypp.html'>stdlib_linalg_lapack_c.fypp</a></li>
     <li><a href='../module/stdlib_linalg_lapack_c.html'>stdlib_linalg_lapack_c</a></li>
     <li class="active">stdlib_claqz0</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    <div id="sidebar">
  <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/stdlib_claqz0.html#src">stdlib_claqz0</a>
  </div>
</div>

</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public recursive subroutine stdlib_claqz0(wants, wantq, wantz, n, ilo, ihi, a, lda, b, ldb, alpha, beta, q, ldq, z, ldz, work, lwork, rwork, rec, info)</h2>
    

    <p>CLAQZ0 computes the eigenvalues of a matrix pair (H,T),
where H is an upper Hessenberg matrix and T is upper triangular,
using the double-shift QZ method.
Matrix pairs of this type are produced by the reduction to
generalized upper Hessenberg form of a matrix pair (A,B):
A = Q1<em>H</em>Z1<strong>H,  B = Q1<em>T</em>Z1</strong>H,
as computed by CGGHRD.
If JOB='S', then the Hessenberg-triangular pair (H,T) is
also reduced to generalized Schur form,
H = Q<em>S</em>Z<strong>H,  T = Q<em>P</em>Z</strong>H,
where Q and Z are unitary matrices, P and S are an upper triangular
matrices.
Optionally, the unitary matrix Q from the generalized Schur
factorization may be postmultiplied into an input matrix Q1, and the
unitary matrix Z may be postmultiplied into an input matrix Z1.
If Q1 and Z1 are the unitary matrices from CGGHRD that reduced
the matrix pair (A,B) to generalized upper Hessenberg form, then the
output matrices Q1<em>Q and Z1</em>Z are the unitary factors from the
generalized Schur factorization of (A,B):
A = (Q1<em>Q)</em>S<em>(Z1</em>Z)<strong>H,  B = (Q1<em>Q)</em>P<em>(Z1</em>Z)</strong>H.
To avoid overflow, eigenvalues of the matrix pair (H,T) (equivalently,
of (A,B)) are computed as a pair of values (alpha,beta), where alpha is
complex and beta real.
If beta is nonzero, lambda = alpha / beta is an eigenvalue of the
generalized nonsymmetric eigenvalue problem (GNEP)
A<em>x = lambda</em>B<em>x
and if alpha is nonzero, mu = beta / alpha is an eigenvalue of the
alternate form of the GNEP
mu</em>A<em>y = B</em>y.
Eigenvalues can be read directly from the generalized Schur
form:
alpha = S(i,i), beta = P(i,i).
Ref: C.B. Moler
Eigenvalue Problems", SIAM J. Numer. Anal., 10(1973),
pp. 241--256.
Ref: B. Kagstrom, D. Kressner, "Multishift Variants of the QZ
Algorithm with Aggressive Early Deflation", SIAM J. Numer.
Anal., 29(2006), pp. 199--227.
Ref: T. Steel, D. Camps, K. Meerbergen, R. Vandebril "A multishift,
multipole rational QZ method with agressive early deflation"</p>

    <h3>Arguments</h3>
      <table class="table table-striped varlist">
<thead><tr><th>Type</th><th>Intent</th><th>Optional</th><th>Attributes</th><th></th><th>Name</th><th></th></thead>
<tbody>
<tr>
  <td><span class="anchor" id="variable-wants~2"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>wants</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-wantq~5"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>wantq</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-wantz~19"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>wantz</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-n~739"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>n</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ilo~37"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ilo</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ihi~38"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ihi</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-a~458"></span>complex(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>a</strong>(lda,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-lda~445"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>lda</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-b~200"></span>complex(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>b</strong>(ldb,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ldb~194"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ldb</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-alpha~80"></span>complex(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>alpha</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-beta~60"></span>complex(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>beta</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-q~42"></span>complex(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>q</strong>(ldq,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ldq~33"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ldq</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-z~74"></span>complex(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>z</strong>(ldz,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ldz~66"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ldz</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-work~398"></span>complex(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>work</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-lwork~199"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>lwork</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-rwork~171"></span>real(kind=sp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>rwork</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-rec~3"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>rec</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-info~526"></span>integer(kind=ilp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>info</strong></td><td></td>
</tr>
</tbody>
</table>

    <br>

    <section class="visible-xs visible-sm hidden-md">
      <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/stdlib_claqz0.html#src">stdlib_claqz0</a>
  </div>
</div>

    </section>
    <br class="visible-xs visible-sm hidden-md">


    
    

    
    


    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="w">     </span><span class="k">recursive subroutine </span><span class="n">stdlib_claqz0</span><span class="p">(</span><span class="w"> </span><span class="n">wants</span><span class="p">,</span><span class="w"> </span><span class="n">wantq</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">     </span><span class="c">!! CLAQZ0 computes the eigenvalues of a matrix pair (H,T),</span>
<span class="w">     </span><span class="c">!! where H is an upper Hessenberg matrix and T is upper triangular,</span>
<span class="w">     </span><span class="c">!! using the double-shift QZ method.</span>
<span class="w">     </span><span class="c">!! Matrix pairs of this type are produced by the reduction to</span>
<span class="w">     </span><span class="c">!! generalized upper Hessenberg form of a matrix pair (A,B):</span>
<span class="w">     </span><span class="c">!! A = Q1*H*Z1**H,  B = Q1*T*Z1**H,</span>
<span class="w">     </span><span class="c">!! as computed by CGGHRD.</span>
<span class="w">     </span><span class="c">!! If JOB=&#39;S&#39;, then the Hessenberg-triangular pair (H,T) is</span>
<span class="w">     </span><span class="c">!! also reduced to generalized Schur form,</span>
<span class="w">     </span><span class="c">!! H = Q*S*Z**H,  T = Q*P*Z**H,</span>
<span class="w">     </span><span class="c">!! where Q and Z are unitary matrices, P and S are an upper triangular</span>
<span class="w">     </span><span class="c">!! matrices.</span>
<span class="w">     </span><span class="c">!! Optionally, the unitary matrix Q from the generalized Schur</span>
<span class="w">     </span><span class="c">!! factorization may be postmultiplied into an input matrix Q1, and the</span>
<span class="w">     </span><span class="c">!! unitary matrix Z may be postmultiplied into an input matrix Z1.</span>
<span class="w">     </span><span class="c">!! If Q1 and Z1 are the unitary matrices from CGGHRD that reduced</span>
<span class="w">     </span><span class="c">!! the matrix pair (A,B) to generalized upper Hessenberg form, then the</span>
<span class="w">     </span><span class="c">!! output matrices Q1*Q and Z1*Z are the unitary factors from the</span>
<span class="w">     </span><span class="c">!! generalized Schur factorization of (A,B):</span>
<span class="w">     </span><span class="c">!! A = (Q1*Q)*S*(Z1*Z)**H,  B = (Q1*Q)*P*(Z1*Z)**H.</span>
<span class="w">     </span><span class="c">!! To avoid overflow, eigenvalues of the matrix pair (H,T) (equivalently,</span>
<span class="w">     </span><span class="c">!! of (A,B)) are computed as a pair of values (alpha,beta), where alpha is</span>
<span class="w">     </span><span class="c">!! complex and beta real.</span>
<span class="w">     </span><span class="c">!! If beta is nonzero, lambda = alpha / beta is an eigenvalue of the</span>
<span class="w">     </span><span class="c">!! generalized nonsymmetric eigenvalue problem (GNEP)</span>
<span class="w">     </span><span class="c">!! A*x = lambda*B*x</span>
<span class="w">     </span><span class="c">!! and if alpha is nonzero, mu = beta / alpha is an eigenvalue of the</span>
<span class="w">     </span><span class="c">!! alternate form of the GNEP</span>
<span class="w">     </span><span class="c">!! mu*A*y = B*y.</span>
<span class="w">     </span><span class="c">!! Eigenvalues can be read directly from the generalized Schur</span>
<span class="w">     </span><span class="c">!! form:</span>
<span class="w">     </span><span class="c">!! alpha = S(i,i), beta = P(i,i).</span>
<span class="w">     </span><span class="c">!! Ref: C.B. Moler</span>
<span class="w">     </span><span class="c">!! Eigenvalue Problems&quot;, SIAM J. Numer. Anal., 10(1973),</span>
<span class="w">     </span><span class="c">!! pp. 241--256.</span>
<span class="w">     </span><span class="c">!! Ref: B. Kagstrom, D. Kressner, &quot;Multishift Variants of the QZ</span>
<span class="w">     </span><span class="c">!! Algorithm with Aggressive Early Deflation&quot;, SIAM J. Numer.</span>
<span class="w">     </span><span class="c">!! Anal., 29(2006), pp. 199--227.</span>
<span class="w">     </span><span class="c">!! Ref: T. Steel, D. Camps, K. Meerbergen, R. Vandebril &quot;A multishift,</span>
<span class="w">     </span><span class="c">!! multipole rational QZ method with agressive early deflation&quot;</span>
<span class="w">               </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">rwork</span><span class="p">,</span><span class="w"> </span><span class="n">rec</span><span class="p">,</span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="c">! arguments</span>
<span class="w">           </span><span class="kt">character</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">wants</span><span class="p">,</span><span class="w"> </span><span class="n">wantq</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="n">rec</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">info</span>
<span class="w">           </span><span class="kt">complex</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w"> </span><span class="n">inout</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="w"> </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">),</span><span class="n">z</span><span class="p">(</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">alpha</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">beta</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="w"> </span><span class="n">out</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">rwork</span><span class="p">(</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span>
<span class="w">           </span>
<span class="w">           </span><span class="c">! local scalars</span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">smlnum</span><span class="p">,</span><span class="w"> </span><span class="n">ulp</span><span class="p">,</span><span class="w"> </span><span class="n">safmin</span><span class="p">,</span><span class="w"> </span><span class="n">safmax</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">tempr</span>
<span class="w">           </span><span class="kt">complex</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">eshift</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">istart</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">iiter</span><span class="p">,</span><span class="w"> </span><span class="n">maxit</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="n">nshifts</span><span class="p">,</span><span class="w"> </span><span class="n">nblock</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="w"> </span><span class="n">nmin</span><span class="p">,&amp;</span>
<span class="w">            </span><span class="n">nibble</span><span class="p">,</span><span class="w"> </span><span class="n">n_undeflated</span><span class="p">,</span><span class="w"> </span><span class="n">n_deflated</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">sweep_info</span><span class="p">,</span><span class="w"> </span><span class="n">shiftpos</span><span class="p">,</span><span class="w"> </span><span class="n">lworkreq</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">istartm</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">            </span><span class="n">istopm</span><span class="p">,</span><span class="w"> </span><span class="n">iwants</span><span class="p">,</span><span class="w"> </span><span class="n">iwantq</span><span class="p">,</span><span class="w"> </span><span class="n">iwantz</span><span class="p">,</span><span class="w"> </span><span class="n">norm_info</span><span class="p">,</span><span class="w"> </span><span class="n">aed_info</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="p">,</span><span class="w"> </span><span class="n">nbr</span><span class="p">,</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="n">itemp1</span><span class="p">,</span><span class="w"> </span><span class="n">itemp2</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                      </span><span class="n">rcost</span>
<span class="w">           </span><span class="kt">logical</span><span class="p">(</span><span class="n">lk</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ilschur</span><span class="p">,</span><span class="w"> </span><span class="n">ilq</span><span class="p">,</span><span class="w"> </span><span class="n">ilz</span>
<span class="w">           </span><span class="kt">character</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">jbcmpz</span><span class="o">*</span><span class="mi">3</span>
<span class="w">           </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wants</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilschur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wants</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;S&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilschur</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">           </span><span class="k">else</span>
<span class="k">              </span><span class="n">iwants</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wantq</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwantq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wantq</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwantq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wantq</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwantq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">           </span><span class="k">else</span>
<span class="k">              </span><span class="n">iwantq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwantz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwantz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;I&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">ilz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="n">iwantz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">3</span>
<span class="w">           </span><span class="k">else</span>
<span class="k">              </span><span class="n">iwantz</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">end if</span>
<span class="w">           </span><span class="c">! check argument values</span>
<span class="w">           </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">iwants</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">iwantq</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">2</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">iwantz</span><span class="o">==</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">3</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">&lt;</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">4</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">ilo</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">5</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">ihi</span><span class="o">&gt;</span><span class="n">n</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">ihi</span><span class="o">&lt;</span><span class="n">ilo</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">6</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">lda</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">8</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">ldb</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">ldq</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">ldq</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">15</span>
<span class="w">           </span><span class="k">else if</span><span class="p">(</span><span class="w"> </span><span class="n">ldz</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">ldz</span><span class="o">&lt;</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">17</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           if</span><span class="p">(</span><span class="w"> </span><span class="n">info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              call </span><span class="n">stdlib_xerbla</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;CLAQZ0&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! quick return if possible</span>
<span class="w">           </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">&lt;=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! get the parameters</span>
<span class="w">           </span><span class="n">jbcmpz</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wants</span>
<span class="w">           </span><span class="n">jbcmpz</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wantq</span>
<span class="w">           </span><span class="n">jbcmpz</span><span class="p">(</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wantz</span>
<span class="w">           </span><span class="n">nmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">12</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CLAQZ0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CLAQZ0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">nwr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">ihi</span><span class="o">-</span><span class="n">ilo</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">nwr</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">nibble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">14</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CLAQZ0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CLAQZ0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">6</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">9</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="o">-</span><span class="n">ilo</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">nsr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nsr</span><span class="o">-</span><span class="nb">mod</span><span class="p">(</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">rcost</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_ilaenv</span><span class="p">(</span><span class="w"> </span><span class="mi">17</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;CLAQZ0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">jbcmpz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">itemp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="w"> </span><span class="n">nsr</span><span class="o">/</span><span class="nb">sqrt</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nsr</span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">rcost</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span><span class="o">/</span><span class="mi">100</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">           </span><span class="n">itemp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">itemp1</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="o">/</span><span class="mi">4</span><span class="w"> </span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="o">+</span><span class="mi">4</span>
<span class="w">           </span><span class="n">nbr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nsr</span><span class="o">+</span><span class="n">itemp1</span>
<span class="w">           </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nmin</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">rec</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              call </span><span class="n">stdlib_chgeqz</span><span class="p">(</span><span class="w"> </span><span class="n">wants</span><span class="p">,</span><span class="w"> </span><span class="n">wantq</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,&amp;</span>
<span class="w">                         </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">rwork</span><span class="p">,</span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! find out required workspace</span>
<span class="w">           </span><span class="c">! workspace query to stdlib_claqz2</span>
<span class="w">           </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">nwr</span><span class="p">,</span><span class="w"> </span><span class="n">nmin</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">call </span><span class="n">stdlib_claqz2</span><span class="p">(</span><span class="w"> </span><span class="n">ilschur</span><span class="p">,</span><span class="w"> </span><span class="n">ilq</span><span class="p">,</span><span class="w"> </span><span class="n">ilz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">           </span><span class="n">n_undeflated</span><span class="p">,</span><span class="w"> </span><span class="n">n_deflated</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">rwork</span><span class="p">,</span><span class="w"> </span><span class="n">rec</span><span class="p">,&amp;</span>
<span class="w">                     </span><span class="n">aed_info</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">itemp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">           </span><span class="c">! workspace query to stdlib_claqz3</span>
<span class="w">           </span><span class="k">call </span><span class="n">stdlib_claqz3</span><span class="p">(</span><span class="w"> </span><span class="n">ilschur</span><span class="p">,</span><span class="w"> </span><span class="n">ilq</span><span class="p">,</span><span class="w"> </span><span class="n">ilz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">nsr</span><span class="p">,</span><span class="w"> </span><span class="n">nbr</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">nbr</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">nbr</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sweep_info</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">itemp2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">int</span><span class="p">(</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">           </span><span class="n">lworkreq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">itemp1</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">itemp2</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">nbr</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="o">==-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">lworkreq</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lwork</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lworkreq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mi">19</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           if</span><span class="p">(</span><span class="w"> </span><span class="n">info</span><span class="o">/=</span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              call </span><span class="n">stdlib_xerbla</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;CLAQZ0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! initialize q and z</span>
<span class="w">           </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">iwantq</span><span class="o">==</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">stdlib_claset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;FULL&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">czero</span><span class="p">,</span><span class="w"> </span><span class="n">cone</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="n">ldq</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">iwantz</span><span class="o">==</span><span class="mi">3</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">stdlib_claset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;FULL&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">czero</span><span class="p">,</span><span class="w"> </span><span class="n">cone</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="n">ldz</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="c">! get machine constants</span>
<span class="w">           </span><span class="n">safmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_slamch</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;SAFE MINIMUM&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">safmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">safmin</span>
<span class="w">           </span><span class="k">call </span><span class="n">stdlib_slabad</span><span class="p">(</span><span class="w"> </span><span class="n">safmin</span><span class="p">,</span><span class="w"> </span><span class="n">safmax</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">ulp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_slamch</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;PRECISION&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">smlnum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">safmin</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span><span class="o">/</span><span class="n">ulp</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">istart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ilo</span>
<span class="w">           </span><span class="n">istop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ihi</span>
<span class="w">           </span><span class="n">maxit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">30</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="n">ihi</span><span class="o">-</span><span class="n">ilo</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">do </span><span class="n">iiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">maxit</span>
<span class="w">              </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">iiter</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">maxit</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                 </span><span class="k">goto</span><span class="w"> </span><span class="mi">80</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">istop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart</span>
<span class="w">                 </span><span class="k">exit</span>
<span class="k">              end if</span>
<span class="w">              </span><span class="c">! check deflations at the end</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">smlnum</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">                 </span><span class="n">istop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span>
<span class="w">                 </span><span class="n">ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                 </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">              </span><span class="k">end if</span>
<span class="w">              </span><span class="c">! check deflations at the start</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">istart</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">smlnum</span><span class="p">,</span><span class="n">ulp</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart</span><span class="p">,</span><span class="w"> </span><span class="n">istart</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                        </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">istart</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">                 </span><span class="n">istart</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                 </span><span class="n">ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                 </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 exit</span>
<span class="k">              end if</span>
<span class="w">              </span><span class="c">! check interior deflations</span>
<span class="w">              </span><span class="n">istart2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart</span>
<span class="w">              </span><span class="k">do </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">smlnum</span><span class="p">,</span><span class="w"> </span><span class="n">ulp</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="n">k</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">                    </span><span class="n">istart2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span>
<span class="w">                    </span><span class="k">exit</span>
<span class="k">                 end if</span>
<span class="k">              end do</span>
<span class="w">              </span><span class="c">! get range to apply rotations to</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilschur</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">istartm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="n">istopm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                 </span><span class="n">istartm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart2</span>
<span class="w">                 </span><span class="n">istopm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span>
<span class="w">              </span><span class="k">end if</span>
<span class="w">              </span><span class="c">! check infinite eigenvalues, this is done without blocking so might</span>
<span class="w">              </span><span class="c">! slow down the method when many infinite eigenvalues are present</span>
<span class="w">              </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span>
<span class="w">              </span><span class="k">do while</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="o">&gt;=</span><span class="n">istart2</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                 </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempr</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">                 if</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">istart2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">tempr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tempr</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">                 if</span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">smlnum</span><span class="p">,</span><span class="w"> </span><span class="n">ulp</span><span class="o">*</span><span class="n">tempr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! a diagonal element of b is negligable, move it</span>
<span class="w">                    </span><span class="c">! to the top and deflate it</span>
<span class="w">                    </span><span class="k">do </span><span class="n">k2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_clartg</span><span class="p">(</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="n">temp</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                       </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">istartm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">istartm</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">istartm</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="o">-</span><span class="n">istartm</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istartm</span><span class="p">,</span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="n">istartm</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ilz</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                          call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="n">s1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">end if</span>
<span class="k">                       if</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">&lt;</span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                          call </span><span class="n">stdlib_clartg</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="p">)</span>
<span class="w">                                    </span>
<span class="w">                          </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                          </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">                          </span><span class="k">call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">istopm</span><span class="o">-</span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">istopm</span><span class="o">-</span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                             call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="nb">conjg</span><span class="p">(</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                                       </span>
<span class="w">                          </span><span class="k">end if</span>
<span class="k">                       end if</span>
<span class="k">                    end do</span>
<span class="k">                    if</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="o">&lt;</span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="k">then</span>
<span class="k">                       call </span><span class="n">stdlib_clartg</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">istart2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="n">temp</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp</span>
<span class="w">                       </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">istopm</span><span class="o">-</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="p">,</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">istopm</span><span class="o">-</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="p">,</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="n">ilq</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                          call </span><span class="n">stdlib_crot</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="nb">conjg</span><span class="p">(&amp;</span>
<span class="w">                                     </span><span class="n">s1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">end if</span>
<span class="k">                    end if</span>
<span class="k">                    </span><span class="n">istart2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">                 </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="o">-</span><span class="mi">1</span>
<span class="w">              </span><span class="k">end do</span>
<span class="w">              </span><span class="c">! istart2 now points to the top of the bottom right</span>
<span class="w">              </span><span class="c">! unreduced hessenberg block</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istart2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">istop</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">istop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart2</span><span class="o">-</span><span class="mi">1</span>
<span class="w">                 </span><span class="n">ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                 </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">                 </span><span class="k">cycle</span>
<span class="k">              end if</span>
<span class="k">              </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nwr</span>
<span class="w">              </span><span class="n">nshifts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nsr</span>
<span class="w">              </span><span class="n">nblock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nbr</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                 </span><span class="c">! setting nw to the size of the subblock will make aed deflate</span>
<span class="w">                 </span><span class="c">! all the eigenvalues. this is slightly more efficient than just</span>
<span class="w">                 </span><span class="c">! using stdlib_chgeqz because the off diagonal part gets updated via blas.</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="n">istart</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                    </span><span class="n">istart2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istart</span>
<span class="w">                 </span><span class="k">else</span>
<span class="k">                    </span><span class="n">nw</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end if</span>
<span class="w">              </span><span class="c">! time for aed</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_claqz2</span><span class="p">(</span><span class="w"> </span><span class="n">ilschur</span><span class="p">,</span><span class="w"> </span><span class="n">ilq</span><span class="p">,</span><span class="w"> </span><span class="n">ilz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">ldq</span><span class="p">,&amp;</span>
<span class="w">               </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">n_undeflated</span><span class="p">,</span><span class="w"> </span><span class="n">n_deflated</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="n">nw</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">nw</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                         </span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">nw</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">rwork</span><span class="p">,</span><span class="w"> </span><span class="n">rec</span><span class="p">,</span><span class="n">aed_info</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n_deflated</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">istop</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="n">n_deflated</span>
<span class="w">                 </span><span class="n">ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                 </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">czero</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="mi">100</span><span class="o">*</span><span class="n">n_deflated</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">nibble</span><span class="o">*</span><span class="p">(</span><span class="w"> </span><span class="n">n_deflated</span><span class="o">+</span><span class="n">n_undeflated</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">istop</span><span class="o">-</span><span class="n">istart2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">nmin</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                 </span><span class="c">! aed has uncovered many eigenvalues. skip a qz sweep and run</span>
<span class="w">                 </span><span class="c">! aed again.</span>
<span class="w">                 </span><span class="k">cycle</span>
<span class="k">              end if</span>
<span class="k">              </span><span class="n">ld</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ld</span><span class="o">+</span><span class="mi">1</span>
<span class="w">              </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">nshifts</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="n">istart2</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">n_undeflated</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">shiftpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="n">n_deflated</span><span class="o">-</span><span class="n">n_undeflated</span><span class="o">+</span><span class="mi">1</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">mod</span><span class="p">(</span><span class="w"> </span><span class="n">ld</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                 </span><span class="c">! exceptional shift.  chosen for no particularly good reason.</span>
<span class="w">                 </span><span class="k">if</span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">maxit</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span><span class="o">*</span><span class="n">safmin</span><span class="w"> </span><span class="p">)</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="o">&lt;</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="o">/</span><span class="n">b</span><span class="p">(</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">else</span>
<span class="k">                    </span><span class="n">eshift</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eshift</span><span class="o">+</span><span class="n">cone</span><span class="o">/</span><span class="p">(</span><span class="w"> </span><span class="n">safmin</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="w"> </span><span class="n">maxit</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">                 </span><span class="n">alpha</span><span class="p">(</span><span class="w"> </span><span class="n">shiftpos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cone</span>
<span class="w">                 </span><span class="n">beta</span><span class="p">(</span><span class="w"> </span><span class="n">shiftpos</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eshift</span>
<span class="w">                 </span><span class="n">ns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">              </span><span class="k">end if</span>
<span class="w">              </span><span class="c">! time for a qz sweep</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_claqz3</span><span class="p">(</span><span class="w"> </span><span class="n">ilschur</span><span class="p">,</span><span class="w"> </span><span class="n">ilq</span><span class="p">,</span><span class="w"> </span><span class="n">ilz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">istart2</span><span class="p">,</span><span class="w"> </span><span class="n">istop</span><span class="p">,</span><span class="w"> </span><span class="n">ns</span><span class="p">,</span><span class="w"> </span><span class="n">nblock</span><span class="p">,</span><span class="n">alpha</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">              </span><span class="n">shiftpos</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">beta</span><span class="p">(</span><span class="w"> </span><span class="n">shiftpos</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="n">ldb</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">nblock</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">nblock</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="w"> </span><span class="n">nblock</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="mi">2</span><span class="o">*</span><span class="n">nblock</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">nblock</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">sweep_info</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">end do</span>
<span class="w">           </span><span class="c">! call stdlib_chgeqz to normalize the eigenvalue blocks and set the eigenvalues</span>
<span class="w">           </span><span class="c">! if all the eigenvalues have been found, stdlib_chgeqz will not do any iterations</span>
<span class="w">           </span><span class="c">! and only normalize the blocks. in case of a rare convergence failure,</span>
<span class="w">           </span><span class="c">! the single shift might perform better.</span>
<span class="w">        </span><span class="mi">80</span><span class="w"> </span><span class="k">call </span><span class="n">stdlib_chgeqz</span><span class="p">(</span><span class="w"> </span><span class="n">wants</span><span class="p">,</span><span class="w"> </span><span class="n">wantq</span><span class="p">,</span><span class="w"> </span><span class="n">wantz</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ilo</span><span class="p">,</span><span class="w"> </span><span class="n">ihi</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">ldb</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">beta</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                  </span><span class="n">ldq</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">,</span><span class="w"> </span><span class="n">ldz</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">rwork</span><span class="p">,</span><span class="n">norm_info</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">norm_info</span>
<span class="w">     </span><span class="k">end subroutine </span><span class="n">stdlib_claqz0</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>Fortran-lang/stdlib was developed by fortran-lang/stdlib contributors<br>&copy; 2024 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
<br /><small>df45374</small></p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2024-04-06 10:42            </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>