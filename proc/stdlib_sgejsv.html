<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   <meta name="description" content="A community driven standard library for (modern) Fortran">
    <meta name="author" content="fortran-lang/stdlib contributors" >
    <link rel="icon" href="../favicon.png">

    <title>stdlib_sgejsv &ndash; Fortran-lang/stdlib</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Fortran-lang/stdlib </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href='../page/index.html'>Contributing and specs</a></li>
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
            <li><a href="../lists/files.html">Source Files</a></li>
            <li><a href="../lists/modules.html">Modules</a></li>
            <li><a href="../lists/procedures.html">Procedures</a></li>
            <li><a href="../lists/absint.html">Abstract Interfaces</a></li>
                   <li><a href="../lists/types.html">Derived Types</a></li>
       
            </ul>
        
            </li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/absint.html">Abstract Interfaces</a></li>
                             <li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>
          </ul>
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
  <div class="row">
    <h1>stdlib_sgejsv
      <small>Subroutine</small>
    </h1>
    <div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
    <li><i class="fa fa-legal"></i> <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a></li> 
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 0.3% of total for procedures.">760 statements</a>
     </li> 
    <li><i class="fa fa-code"></i><a href="../src/stdlib_linalg_lapack_s.fypp"> Source File</a></li>
  </ul>
  <ol class="breadcrumb in-well text-right">
     <li><a href='../sourcefile/stdlib_linalg_lapack_s.fypp.html'>stdlib_linalg_lapack_s.fypp</a></li>
     <li><a href='../module/stdlib_linalg_lapack_s.html'>stdlib_linalg_lapack_s</a></li>
     <li class="active">stdlib_sgejsv</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    <div id="sidebar">
  <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/stdlib_sgejsv.html#src">stdlib_sgejsv</a>
  </div>
</div>

</div>

    </div>
    
    <div class="col-md-9" id='text'>
    <h2>public pure subroutine stdlib_sgejsv(joba, jobu, jobv, jobr, jobt, jobp, m, n, a, lda, sva, u, ldu, v, ldv, work, lwork, iwork, info)</h2>
    

    <p>matrix [A], where M &gt;= N. The SVD of [A] is written as
[A] = [U] * [SIGMA] * [V]^t,
where [SIGMA] is an N-by-N (M-by-N) matrix which is zero except for its N
diagonal elements, [U] is an M-by-N (or M-by-M) orthonormal matrix, and
[V] is an N-by-N orthogonal matrix. The diagonal elements of [SIGMA] are
the singular values of [A]. The columns of [U] and [V] are the left and
the right singular vectors of [A], respectively. The matrices [U] and [V]
are computed and stored in the arrays U and V, respectively. The diagonal
of [SIGMA] is computed and stored in the array SVA.
SGEJSV can sometimes compute tiny singular values and their singular vectors much
more accurately than other SVD routines, see below under Further Details.</p>

    <h3>Arguments</h3>
      <table class="table table-striped varlist">
<thead><tr><th>Type</th><th>Intent</th><th>Optional</th><th>Attributes</th><th></th><th>Name</th><th></th></thead>
<tbody>
<tr>
  <td><span class="anchor" id="variable-joba"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>joba</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-jobu"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>jobu</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-jobv"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>jobv</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-jobr"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>jobr</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-jobt"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>jobt</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-jobp"></span>character,</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>jobp</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-m~15"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>m</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-n~48"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>n</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-a~26"></span>real(kind=sp),</td>
<td>intent(inout)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>a</strong>(lda,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-lda~23"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>lda</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-sva"></span>real(kind=sp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>sva</strong>(n)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-u~3"></span>real(kind=sp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>u</strong>(ldu,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ldu~3"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ldu</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-v~2"></span>real(kind=sp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>v</strong>(ldv,*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-ldv~2"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>ldv</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-work~33"></span>real(kind=sp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>work</strong>(lwork)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-lwork~8"></span>integer(kind=ilp),</td>
<td>intent(in)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>lwork</strong></td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-iwork~12"></span>integer(kind=ilp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>iwork</strong>(*)</td><td></td>
</tr>
<tr>
  <td><span class="anchor" id="variable-info~33"></span>integer(kind=ilp),</td>
<td>intent(out)</td>
  <td></td>  <td></td><td>::</td>
  <td><strong>info</strong></td><td></td>
</tr>
</tbody>
</table>

    <br>

    <section class="visible-xs visible-sm hidden-md">
      <h3>Contents</h3>
 
<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../proc/stdlib_sgejsv.html#src">stdlib_sgejsv</a>
  </div>
</div>

    </section>
    <br class="visible-xs visible-sm hidden-md">


    
    

    
    


    
    <section>
    <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="highlight"><pre><span></span><span class="w">     </span><span class="k">pure subroutine </span><span class="n">stdlib_sgejsv</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="n">jobu</span><span class="p">,</span><span class="w"> </span><span class="n">jobv</span><span class="p">,</span><span class="w"> </span><span class="n">jobr</span><span class="p">,</span><span class="w"> </span><span class="n">jobt</span><span class="p">,</span><span class="w"> </span><span class="n">jobp</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">               </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">        </span><span class="c">! -- lapack computational routine --</span>
<span class="w">        </span><span class="c">! -- lapack is a software package provided by univ. of tennessee,    --</span>
<span class="w">        </span><span class="c">! -- univ. of california berkeley, univ. of colorado denver and nag ltd..--</span>
<span class="w">           </span><span class="c">! Scalar Arguments </span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">info</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">           </span><span class="c">! Array Arguments </span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">lda</span><span class="p">,</span><span class="o">*</span><span class="p">)</span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">ldu</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">ldv</span><span class="p">,</span><span class="o">*</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">lwork</span><span class="p">)</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="o">*</span><span class="p">)</span>
<span class="w">           </span><span class="kt">character</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="n">jobp</span><span class="p">,</span><span class="w"> </span><span class="n">jobr</span><span class="p">,</span><span class="w"> </span><span class="n">jobt</span><span class="p">,</span><span class="w"> </span><span class="n">jobu</span><span class="p">,</span><span class="w"> </span><span class="n">jobv</span>
<span class="w">        </span><span class="c">! ===========================================================================</span>
<span class="w">           </span>
<span class="w">           </span><span class="c">! Local Scalars </span>
<span class="w">           </span><span class="kt">real</span><span class="p">(</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">aapp</span><span class="p">,</span><span class="w"> </span><span class="n">aaqq</span><span class="p">,</span><span class="w"> </span><span class="n">aatmax</span><span class="p">,</span><span class="w"> </span><span class="n">aatmin</span><span class="p">,</span><span class="w"> </span><span class="n">big</span><span class="p">,</span><span class="w"> </span><span class="n">big1</span><span class="p">,</span><span class="w"> </span><span class="n">cond_ok</span><span class="p">,</span><span class="w"> </span><span class="n">condr1</span><span class="p">,</span><span class="w"> </span><span class="n">condr2</span><span class="p">,</span><span class="w"> </span><span class="n">entra</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">entrat</span><span class="p">,</span><span class="w"> </span><span class="n">epsln</span><span class="p">,</span><span class="w"> </span><span class="n">maxprj</span><span class="p">,</span><span class="w"> </span><span class="n">scalem</span><span class="p">,</span><span class="w"> </span><span class="n">sconda</span><span class="p">,</span><span class="w"> </span><span class="n">sfmin</span><span class="p">,</span><span class="w"> </span><span class="n">small</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">uscal1</span><span class="p">,</span><span class="w"> </span><span class="n">uscal2</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span>
<span class="w">           </span><span class="kt">integer</span><span class="p">(</span><span class="n">ilp</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">ierr</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">numrank</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="p">,</span><span class="w"> </span><span class="n">warning</span>
<span class="w">           </span><span class="kt">logical</span><span class="p">(</span><span class="n">lk</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">almort</span><span class="p">,</span><span class="w"> </span><span class="n">defr</span><span class="p">,</span><span class="w"> </span><span class="n">errest</span><span class="p">,</span><span class="w"> </span><span class="n">goscal</span><span class="p">,</span><span class="w"> </span><span class="n">jracc</span><span class="p">,</span><span class="w"> </span><span class="nb">kill</span><span class="p">,</span><span class="w"> </span><span class="n">lsvec</span><span class="p">,</span><span class="w"> </span><span class="n">l2aber</span><span class="p">,</span><span class="w"> </span><span class="n">l2kill</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="n">l2pert</span><span class="p">,</span><span class="w"> </span><span class="n">l2rank</span><span class="p">,</span><span class="w"> </span><span class="n">l2tran</span><span class="p">,</span><span class="w"> </span><span class="n">noscal</span><span class="p">,</span><span class="w"> </span><span class="n">rowpiv</span><span class="p">,</span><span class="w"> </span><span class="n">rsvec</span><span class="p">,</span><span class="w"> </span><span class="n">transp</span>
<span class="w">           </span><span class="c">! Intrinsic Functions </span>
<span class="w">           </span><span class="k">intrinsic</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="nb">abs</span><span class="p">,</span><span class="nb">log</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span><span class="nb">min</span><span class="p">,</span><span class="nb">float</span><span class="p">,</span><span class="nb">nint</span><span class="p">,</span><span class="nb">sign</span><span class="p">,</span><span class="nb">sqrt</span>
<span class="w">           </span><span class="c">! test the input arguments</span>
<span class="w">           </span><span class="n">lsvec</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobu</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobu</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">jracc</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobv</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;J&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">rsvec</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobv</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">jracc</span>
<span class="w">           </span><span class="n">rowpiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">l2rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">l2aber</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">errest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;E&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">l2tran</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobt</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">l2kill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobr</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;R&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">defr</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobr</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">l2pert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobp</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;P&#39;</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">l2rank</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">l2aber</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">errest</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">joba</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;C&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="w"> </span><span class="n">lsvec</span><span class="w">  </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobu</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobu</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;W&#39;</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">)&amp;</span>
<span class="w">                      </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">2</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobv</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobv</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;W&#39;</span><span class="w"> </span><span class="p">))</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                     </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">jracc</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">3</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2kill</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">defr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w">    </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">4</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobt</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">5</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobp</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">6</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">7</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">8</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lda</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">10</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">13</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">15</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">errest</span><span class="p">).</span><span class="nb">and</span><span class="p">.(</span><span class="n">lwork</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">)))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.(&amp;</span>
<span class="w">           </span><span class="p">.</span><span class="nb">not</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.(</span><span class="n">lwork</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">)))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">           </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">rsvec</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">lwork</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))).</span><span class="nb">or</span><span class="p">.(</span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">lsvec</span><span class="p">)</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">           </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">lwork</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">,</span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))).</span><span class="nb">or</span><span class="p">.(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="n">jracc</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.(&amp;</span>
<span class="w">           </span><span class="n">lwork</span><span class="o">&lt;</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">,</span><span class="mi">6</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">))).</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">jracc</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="n">lwork</span><span class="o">&lt;</span><span class="nb">max</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="p">,&amp;</span>
<span class="w">                     </span><span class="mi">4</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">6</span><span class="p">)))</span><span class="k">then</span>
<span class="k">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">17</span>
<span class="w">           </span><span class="k">else</span>
<span class="w">              </span><span class="c">! #:)</span>
<span class="w">              </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">             </span><span class="c">! #:(</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_xerbla</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;SGEJSV&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! quick return for void matrix (y3k safe)</span>
<span class="w">       </span><span class="c">! #:)</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="n">work</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           endif</span>
<span class="w">           </span><span class="c">! determine whether the matrix u should be m x n or m x m</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">stdlib_lsame</span><span class="p">(</span><span class="w"> </span><span class="n">jobu</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;F&#39;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m</span>
<span class="w">           </span><span class="k">end if</span>
<span class="w">           </span><span class="c">! set numerical parameters</span>
<span class="w">      </span><span class="c">! !    note: make sure stdlib_slamch() does not fail on the target architecture.</span>
<span class="w">           </span><span class="n">epsln</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_slamch</span><span class="p">(</span><span class="s1">&#39;EPSILON&#39;</span><span class="p">)</span>
<span class="w">           </span><span class="n">sfmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_slamch</span><span class="p">(</span><span class="s1">&#39;SAFEMINIMUM&#39;</span><span class="p">)</span>
<span class="w">           </span><span class="n">small</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sfmin</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">epsln</span>
<span class="w">           </span><span class="n">big</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_slamch</span><span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">)</span>
<span class="w">           </span><span class="c">! big   = one / sfmin</span>
<span class="w">           </span><span class="c">! initialize sva(1:n) = diag( ||a e_i||_2 )_1^n</span>
<span class="w">      </span><span class="c">! (!)  if necessary, scale sva() to protect the largest norm from</span>
<span class="w">           </span><span class="c">! overflow. it is possible that this scaling pushes the smallest</span>
<span class="w">           </span><span class="c">! column norm left from the underflow threshold (extreme case).</span>
<span class="w">           </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span><span class="o">*</span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span>
<span class="w">           </span><span class="n">noscal</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">           </span><span class="n">goscal</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">           </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">              </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">              </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_slassq</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">aapp</span><span class="p">,</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">9</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_xerbla</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;SGEJSV&#39;</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">return</span>
<span class="k">              end if</span>
<span class="k">              </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">aaqq</span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">big</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">aaqq</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">noscal</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">aaqq</span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                 </span><span class="n">noscal</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                 </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scalem</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">goscal</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">goscal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">scalem</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end if</span>
<span class="k">           end do</span>
<span class="k">           if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">noscal</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">scalem</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">           </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">           </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">big</span>
<span class="w">           </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">              </span><span class="n">aapp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">end do</span>
<span class="w">           </span><span class="c">! quick return for zero m x n matrix</span>
<span class="w">       </span><span class="c">! #:)</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w">  </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              </span><span class="n">iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="n">iwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="k">return</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! issue warning if denormalized column norms detected. override the</span>
<span class="w">           </span><span class="c">! high relative accuracy request. issue licence to kill columns</span>
<span class="w">           </span><span class="c">! (set them to zero) whose norm is less than sigma_max / big (roughly).</span>
<span class="w">       </span><span class="c">! #:(</span>
<span class="w">           </span><span class="n">warning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">l2rank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="n">l2kill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="n">warning</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">           </span><span class="k">end if</span>
<span class="w">           </span><span class="c">! quick return for one-column matrix</span>
<span class="w">       </span><span class="c">! #:)</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 call </span><span class="n">stdlib_slascl</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sva</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">scalem</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">lda</span><span class="p">,</span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="c">! computing all m left singular vectors of the m x 1 matrix</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">n</span><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_sgeqrf</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sorgqr</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="n">n1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                  </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">big</span><span class="o">*</span><span class="n">scalem</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">scalem</span>
<span class="w">                 </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              </span><span class="n">work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">scalem</span>
<span class="w">              </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">scalem</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="k">else</span>
<span class="k">                    </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              else</span>
<span class="k">                 </span><span class="n">iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                 </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              </span><span class="n">iwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                 </span><span class="n">work</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              return</span>
<span class="k">           end if</span>
<span class="k">           </span><span class="n">transp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">           </span><span class="n">l2tran</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="n">one</span>
<span class="w">           </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">big</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">           </span><span class="c">! compute the row norms, needed to determine row pivoting sequence</span>
<span class="w">           </span><span class="c">! (in the case of heavily row weighted a, row pivoting is strongly</span>
<span class="w">           </span><span class="c">! advised) and to collect information needed to compare the</span>
<span class="w">           </span><span class="c">! structures of a * a^t and a^t * a (in the case l2tran==.true.).</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span>
<span class="w">                    </span><span class="n">xsc</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                    </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slassq</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="c">! stdlib_slassq gets both the ell_2 and the ell_infinity norm</span>
<span class="w">                    </span><span class="c">! in one pass through the vector</span>
<span class="w">                    </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scalem</span>
<span class="w">                    </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">scalem</span><span class="o">*</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">temp1</span><span class="p">))</span>
<span class="w">                    </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">aatmax</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="n">aatmin</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">))</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">              else</span>
<span class="k">                 do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span>
<span class="w">                    </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scalem</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">stdlib_isamax</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">lda</span><span class="p">))</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">max</span><span class="p">(</span><span class="w"> </span><span class="n">aatmax</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">aatmin</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">              end if</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! for square matrix a try to determine whether a^t  would be  better</span>
<span class="w">           </span><span class="c">! input for the preconditioned jacobi svd, with faster convergence.</span>
<span class="w">           </span><span class="c">! the decision is based on an o(n) function of the vector of column</span>
<span class="w">           </span><span class="c">! and row norms of a, based on the shannon entropy. this should give</span>
<span class="w">           </span><span class="c">! the right choice in most cases when the difference actually matters.</span>
<span class="w">           </span><span class="c">! it may fail and pick the slower converging side.</span>
<span class="w">           </span><span class="n">entra</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">           </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">xsc</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">              </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_slassq</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">              </span><span class="n">entra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="n">big1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">big1</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">entra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entra</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">big1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">big1</span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              </span><span class="n">entra</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">entra</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span>
<span class="w">              </span><span class="c">! now, sva().^2/trace(a^t * a) is a point in the probability simplex.</span>
<span class="w">              </span><span class="c">! it is derived from the diagonal of  a^t * a.  do the same with the</span>
<span class="w">              </span><span class="c">! diagonal of a * a^t, compute the entropy of the corresponding</span>
<span class="w">              </span><span class="c">! probability distribution. note that a * a^t and a^t * a have the</span>
<span class="w">              </span><span class="c">! same trace.</span>
<span class="w">              </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">+</span><span class="n">m</span>
<span class="w">                 </span><span class="n">big1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">big1</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">zero</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entrat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">big1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="n">big1</span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              </span><span class="n">entrat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">entrat</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">log</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span>
<span class="w">              </span><span class="c">! analyze the entropies and decide a or a^t. smaller entropy</span>
<span class="w">              </span><span class="c">! usually means better input for the algorithm.</span>
<span class="w">              </span><span class="n">transp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">entrat</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">entra</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="c">! if a^t is better than a, transpose a.</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                 </span><span class="c">! in an optimal implementation, this trivial transpose</span>
<span class="w">                 </span><span class="c">! should be replaced with faster transpose.</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                        </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="w">                       </span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                       </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                 end do</span>
<span class="k">                 do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="w">                    </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w">      </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 </span><span class="n">temp1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span>
<span class="w">                 </span><span class="n">aapp</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">aatmax</span>
<span class="w">                 </span><span class="n">aatmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">                 </span><span class="n">temp1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">aaqq</span>
<span class="w">                 </span><span class="n">aaqq</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">aatmin</span>
<span class="w">                 </span><span class="n">aatmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">                 </span><span class="nb">kill</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="n">lsvec</span>
<span class="w">                 </span><span class="n">lsvec</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">rsvec</span>
<span class="w">                 </span><span class="n">rsvec</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">kill</span>
<span class="nb">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="n">rowpiv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! end if l2tran</span>
<span class="w">           </span><span class="c">! scale the matrix so that its maximal singular value remains less</span>
<span class="w">           </span><span class="c">! than sqrt(big) -- the matrix is scaled so that its maximal column</span>
<span class="w">           </span><span class="c">! has euclidean norm equal to sqrt(big/n). the only reason to keep</span>
<span class="w">           </span><span class="c">! sqrt(big) instead of big is the fact that stdlib_sgejsv uses lapack and</span>
<span class="w">           </span><span class="c">! blas routines that, in some implementations, are not capable of</span>
<span class="w">           </span><span class="c">! working in the full interval [sfmin,big] and that they may provoke</span>
<span class="w">           </span><span class="c">! overflows in the intermediate results. if the singular values spread</span>
<span class="w">           </span><span class="c">! from sfmin to big, then stdlib_sgesvj will compute them. so, in that case,</span>
<span class="w">           </span><span class="c">! one should use stdlib_sgesvj instead of stdlib_sgejsv.</span>
<span class="w">           </span><span class="n">big1</span><span class="w">   </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="n">temp1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="w"> </span><span class="n">big</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">call </span><span class="n">stdlib_slascl</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">aapp</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">aapp</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">sfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">               </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">aapp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">           </span><span class="k">else</span>
<span class="k">               </span><span class="n">aaqq</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">aapp</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scalem</span>
<span class="w">           </span><span class="k">call </span><span class="n">stdlib_slascl</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">aapp</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="c">! to undo scaling at the end of this procedure, multiply the</span>
<span class="w">           </span><span class="c">! computed singular values with uscal2 / uscal1.</span>
<span class="w">           </span><span class="n">uscal1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">           </span><span class="n">uscal2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">aapp</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2kill</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! l2kill enforces computation of nonzero singular values in</span>
<span class="w">              </span><span class="c">! the restricted range of condition number of the initial a,</span>
<span class="w">              </span><span class="c">! sigma_max(a) / sigma_min(a) approx. sqrt(big)/sqrt(sfmin).</span>
<span class="w">              </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="w"> </span><span class="n">sfmin</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">else</span>
<span class="k">              </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">small</span>
<span class="w">              </span><span class="c">! now, if the condition number of a is too big,</span>
<span class="w">              </span><span class="c">! sigma_max(a) / sigma_min(a) &gt; sqrt(big/n) * epsln / sfmin,</span>
<span class="w">              </span><span class="c">! as a precaution measure, the full svd is computed using stdlib_sgesvj</span>
<span class="w">              </span><span class="c">! with accumulated jacobi rotations. this provides numerically</span>
<span class="w">              </span><span class="c">! more robust computation, at the cost of slightly increased run</span>
<span class="w">              </span><span class="c">! time. depending on the concrete implementation of blas and lapack</span>
<span class="w">              </span><span class="c">! (i.e. how they behave in presence of extreme ill-conditioning) the</span>
<span class="w">              </span><span class="c">! implementor may decide to remove this switch.</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="o">&lt;</span><span class="nb">sqrt</span><span class="p">(</span><span class="n">sfmin</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">jracc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">           end if</span>
<span class="k">           if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">aaqq</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end do</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! preconditioning using qr factorization with pivoting</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! optional row permutation (bjoerck row pivoting):</span>
<span class="w">              </span><span class="c">! a result by cox and higham shows that the bjoerck&#39;s</span>
<span class="w">              </span><span class="c">! row pivoting combined with standard column pivoting</span>
<span class="w">              </span><span class="c">! has similar effect as powell-reid complete pivoting.</span>
<span class="w">              </span><span class="c">! the ell-infinity norms of a are made nonincreasing.</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_isamax</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">q</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">temp1</span><span class="w">       </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
<span class="w">                    </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">q</span><span class="p">)</span>
<span class="w">                    </span><span class="n">work</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="n">n</span><span class="o">+</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temp1</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end do</span>
<span class="k">              call </span><span class="n">stdlib_slaswp</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="k">end if</span>
<span class="w">           </span><span class="c">! end of the preparation phase (scaling, optional sorting and</span>
<span class="w">           </span><span class="c">! transposing, optional flushing of small columns).</span>
<span class="w">           </span><span class="c">! preconditioning</span>
<span class="w">           </span><span class="c">! if the full svd is needed, the right singular vectors are computed</span>
<span class="w">           </span><span class="c">! from a matrix equation, and for that we need theoretical analysis</span>
<span class="w">           </span><span class="c">! of the businger-golub pivoting. so we use stdlib_sgeqp3 as the first rr qrf.</span>
<span class="w">           </span><span class="c">! in all other cases the first rr qrf can be chosen by other criteria</span>
<span class="w">           </span><span class="c">! (eg speed by replacing global with restricted window pivoting, such</span>
<span class="w">           </span><span class="c">! as in sgeqpx from toms # 782). good results will be obtained using</span>
<span class="w">           </span><span class="c">! sgeqpx with properly (!) chosen numerical parameters.</span>
<span class="w">           </span><span class="c">! any improvement of stdlib_sgeqp3 improves overall performance of stdlib_sgejsv.</span>
<span class="w">           </span><span class="c">! a * p1 = q1 * [ r1^t 0]^t:</span>
<span class="w">           </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">              </span><span class="c">! All Columns Are Free Columns</span>
<span class="w">              </span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">           </span><span class="k">end do</span>
<span class="k">           call </span><span class="n">stdlib_sgeqp3</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="c">! the upper triangular matrix r1 from the first qrf is inspected for</span>
<span class="w">           </span><span class="c">! rank deficiency and possibilities for deflation, or possible</span>
<span class="w">           </span><span class="c">! ill-conditioning. depending on the user specified flag l2rank,</span>
<span class="w">           </span><span class="c">! the procedure explores possibilities to reduce the numerical</span>
<span class="w">           </span><span class="c">! rank by inspecting the computed upper triangular factor. if</span>
<span class="w">           </span><span class="c">! l2rank or l2aber are up, then stdlib_sgejsv will compute the svd of</span>
<span class="w">           </span><span class="c">! a + da, where ||da|| &lt;= f(m,n)*epsln.</span>
<span class="w">           </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2aber</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! standard absolute error bound suffices. all sigma_i with</span>
<span class="w">              </span><span class="c">! sigma_i &lt; n*epsln*||a|| are flushed to zero. this is an</span>
<span class="w">              </span><span class="c">! aggressive enforcement of lower numerical rank by introducing a</span>
<span class="w">              </span><span class="c">! backward error of the order of n*epsln*||a||.</span>
<span class="w">              </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="p">(</span><span class="n">temp1</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="k">else</span>
<span class="k">                    go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">3002</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end do</span>
<span class="k">              </span><span class="mi">3002</span><span class="w"> </span><span class="k">continue</span>
<span class="k">           else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2rank</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! .. similarly as above, only slightly more gentle (less aggressive).</span>
<span class="w">              </span><span class="c">! sudden drop on the diagonal of r1 is used as the criterion for</span>
<span class="w">              </span><span class="c">! close-to-rank-deficient.</span>
<span class="w">              </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">sfmin</span><span class="p">)</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">epsln</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="n">l2kill</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="mi">3402</span>
<span class="w">                 </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              </span><span class="mi">3402</span><span class="w"> </span><span class="k">continue</span>
<span class="k">           else</span>
<span class="w">              </span><span class="c">! the goal is high relative accuracy. however, if the matrix</span>
<span class="w">              </span><span class="c">! has high scaled condition number the relative accuracy is in</span>
<span class="w">              </span><span class="c">! general not feasible. later on, a condition number estimator</span>
<span class="w">              </span><span class="c">! will be deployed to estimate the scaled condition number.</span>
<span class="w">              </span><span class="c">! here we just remove the underflowed part of the triangular</span>
<span class="w">              </span><span class="c">! factor. this prevents the situation in which the code is</span>
<span class="w">              </span><span class="c">! working hard to get the accuracy not warranted by the data.</span>
<span class="w">              </span><span class="n">temp1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">sfmin</span><span class="p">)</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">small</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.(</span><span class="w"> </span><span class="n">l2kill</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">go</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="mi">3302</span>
<span class="w">                 </span><span class="n">nr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              </span><span class="mi">3302</span><span class="w"> </span><span class="k">continue</span>
<span class="k">           end if</span>
<span class="k">           </span><span class="n">almort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">false</span><span class="p">.</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">maxprj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="n">temp1</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="w">                 </span><span class="n">maxprj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">maxprj</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">maxprj</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span><span class="o">*</span><span class="n">epsln</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">almort</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">.</span><span class="n">true</span><span class="p">.</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">one</span>
<span class="w">           </span><span class="n">condr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">one</span>
<span class="w">           </span><span class="n">condr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">one</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! V Is Available As Workspace</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    call </span><span class="n">stdlib_spocon</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! U Is Available As Workspace</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    call </span><span class="n">stdlib_spocon</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">else</span>
<span class="k">                    call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="w">                 </span><span class="c">! The Columns Of R Are Scaled To Have Unit Euclidean Lengths</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_spocon</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">                 </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
<span class="w">                 </span><span class="c">! sconda is an estimate of sqrt(||(r^t * r)^(-1)||_1).</span>
<span class="w">                 </span><span class="c">! n^(-1/4) * sconda &lt;= ||r^(-1)||_2 &lt;= n^(1/4) * sconda</span>
<span class="w">              </span><span class="k">else</span>
<span class="k">                 </span><span class="n">sconda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">           end if</span>
<span class="k">           </span><span class="n">l2pert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">a</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">big1</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">           </span><span class="c">! if there is no violent scaling, artificial perturbation is not needed.</span>
<span class="w">           </span><span class="c">! phase 3:</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">               </span><span class="c">! singular values only</span>
<span class="w">               </span><span class="c">! .. transpose a(1:nr,1:n)</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="w">              </span><span class="c">! the following two do-loops introduce small relative perturbation</span>
<span class="w">              </span><span class="c">! into the strict upper triangle of the lower triangular matrix.</span>
<span class="w">              </span><span class="c">! small entries below the main diagonal are also changed.</span>
<span class="w">              </span><span class="c">! this modification is useful if the computing environment does not</span>
<span class="w">              </span><span class="c">! provide/allow flush to zero underflow, for it prevents many</span>
<span class="w">              </span><span class="c">! annoying denormalized numbers in case of strongly scaled matrices.</span>
<span class="w">              </span><span class="c">! the perturbation is structured so that it does not introduce any</span>
<span class="w">              </span><span class="c">! new perturbation of the singular values, and it does not destroy</span>
<span class="w">              </span><span class="c">! the job done by the preconditioner.</span>
<span class="w">              </span><span class="c">! the licence for this perturbation is in the variable l2pert, which</span>
<span class="w">              </span><span class="c">! should be .false. if flush to zero underflow is active.</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">almort</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! xsc = sqrt(small)</span>
<span class="w">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epsln</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                 else</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">lda</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="w">                  </span><span class="c">! Second Preconditioning Using The Qr Factorization</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sgeqrf</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="c">! And Transpose Upper To Lower Triangular</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">              end if</span>
<span class="w">                 </span><span class="c">! row-cyclic jacobi svd algorithm with column pivoting</span>
<span class="w">                 </span><span class="c">! .. again some perturbation (a &quot;background noise&quot;) is added</span>
<span class="w">                 </span><span class="c">! to drown denormals</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! xsc = sqrt(small)</span>
<span class="w">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epsln</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">))</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">&gt;</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="o">&lt;=</span><span class="n">temp1</span><span class="p">)</span><span class="w"> </span><span class="p">).</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                 else</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="w">                 </span><span class="c">! .. and one-sided jacobi rotations are started on a lower</span>
<span class="w">                 </span><span class="c">! triangular matrix (plus perturbation which is ignored in</span>
<span class="w">                 </span><span class="c">! the part which destroys triangular form (confusing?!))</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NOU&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NOV&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                 </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">           </span><span class="k">else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! -&gt; singular values and right singular vectors &lt;-</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">almort</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                 </span><span class="c">! In This Case Nr Equals N</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">lda</span><span class="p">,</span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">lwork</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                           </span>
<span class="w">                 </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                 </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">              </span><span class="k">else</span>
<span class="w">              </span><span class="c">! .. two more qr factorizations ( one qrf is not enough, two require</span>
<span class="w">              </span><span class="c">! accumulated product of jacobi rotations, three are perfect )</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sgelqf</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sgeqrf</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                           </span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                 </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w">   </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              call </span><span class="n">stdlib_sormlq</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LEFT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;TRANSPOSE&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">           else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">              </span><span class="c">! Singular Values And Left Singular Vectors                 </span>
<span class="w">              </span><span class="c">! Second Preconditioning Step To Avoid Need To Accumulate</span>
<span class="w">              </span><span class="c">! jacobi rotations in the jacobi iterations.</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_sgeqrf</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">              </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w">  </span><span class="n">m</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end if</span>
<span class="k">              call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LEFT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO TR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_slaswp</span><span class="p">(</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span>
<span class="w">                 </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;ALL&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">           else</span>
<span class="w">              </span><span class="c">! Full Svd </span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">jracc</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">.</span><span class="nb">not</span><span class="p">.</span><span class="w"> </span><span class="n">almort</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                 </span><span class="c">! second preconditioning step (qrf [with pivoting])</span>
<span class="w">                 </span><span class="c">! note that the composition of transpose, qrf and transpose is</span>
<span class="w">                 </span><span class="c">! equivalent to an lqf call. since in many libraries the qrf</span>
<span class="w">                 </span><span class="c">! seems to be better optimized than the lqf, we do explicit</span>
<span class="w">                 </span><span class="c">! transpose and use the qrf. this is subject to changes in an</span>
<span class="w">                 </span><span class="c">! optimized implementation of stdlib_sgejsv.</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="w">                 </span><span class="c">! The Following Two Loops Perturb Small Entries To Avoid</span>
<span class="w">                 </span><span class="c">! denormals in the second qr factorization, where they are</span>
<span class="w">                 </span><span class="c">! as good as zeros. this is done to avoid painfully slow</span>
<span class="w">                 </span><span class="c">! computation with denormals. the relative size of the perturbation</span>
<span class="w">                 </span><span class="c">! is a parameter that can be changed by the implementer.</span>
<span class="w">                 </span><span class="c">! this perturbation device will be obsolete on machines with</span>
<span class="w">                 </span><span class="c">! properly implemented arithmetic.</span>
<span class="w">                 </span><span class="c">! to switch it off, set l2pert=.false. to remove it from  the</span>
<span class="w">                 </span><span class="c">! code, remove the action under l2pert=.true., leave the else part.</span>
<span class="w">                 </span><span class="c">! the following two loops should be blocked and fused with the</span>
<span class="w">                 </span><span class="c">! transposed copy above.</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">).</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                                    </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                 else</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="w">                 </span><span class="c">! estimate the row scaled condition number of r1</span>
<span class="w">                 </span><span class="c">! (if r1 is rectangular, n &gt; nr, then the condition number</span>
<span class="w">                 </span><span class="c">! of the leading nr x nr submatrix is estimated.)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                    </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">one</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 call </span><span class="n">stdlib_spocon</span><span class="p">(</span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">nr</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">nr</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">iwork</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                           </span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ierr</span><span class="p">)</span>
<span class="w">                 </span><span class="n">condr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
<span class="w">                 </span><span class="c">! Here Need A Second Opinion On The Condition Number</span>
<span class="w">                 </span><span class="c">! Then Assume Worst Case Scenario</span>
<span class="w">                 </span><span class="c">! r1 is ok for inverse &lt;=&gt; condr1 &lt; real(n,KIND=sp)</span>
<span class="w">                 </span><span class="c">! more conservative    &lt;=&gt; condr1 &lt; sqrt(real(n,KIND=sp))</span>
<span class="w">                 </span><span class="n">cond_ok</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span>
<span class="w">      </span><span class="c">! [tp]       cond_ok is a tuning parameter.</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                    </span><span class="c">! .. the second qrf without pivoting. note: in an optimized</span>
<span class="w">                    </span><span class="c">! implementation, this qrf should be implemented as the qrf</span>
<span class="w">                    </span><span class="c">! of a lower triangular matrix.</span>
<span class="w">                    </span><span class="c">! r1^t = q2 * r2</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sgeqrf</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                              </span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="p">)</span><span class="o">/</span><span class="n">epsln</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                             </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)))</span>
<span class="w">                             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">end do</span>
<span class="k">                       end do</span>
<span class="k">                    end if</span>
<span class="k">                    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="c">! .. save ...</span>
<span class="w">                 </span><span class="c">! This Transposed Copy Should Be Better Than Naive</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    </span><span class="n">condr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">condr1</span>
<span class="w">                 </span><span class="k">else</span>
<span class="w">                    </span><span class="c">! .. ill-conditioned case: second qrf with pivoting</span>
<span class="w">                    </span><span class="c">! note that windowed pivoting would be equally good</span>
<span class="w">                    </span><span class="c">! numerically, and more run-time efficient. so, in</span>
<span class="w">                    </span><span class="c">! an optimal implementation, the next call to stdlib_sgeqp3</span>
<span class="w">                    </span><span class="c">! should be replaced with eg. call sgeqpx (acm toms #782)</span>
<span class="w">                    </span><span class="c">! with properly (carefully) chosen parameters.</span>
<span class="w">                    </span><span class="c">! r1^t * p2 = q2 * r2</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="n">iwork</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    call </span><span class="n">stdlib_sgeqp3</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwork</span><span class="o">-</span><span class="p">&amp;</span>
<span class="w">                              </span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">      </span><span class="c">! *               call stdlib_sgeqrf( n, nr, v, ldv, work(n+1), work(2*n+1),</span>
<span class="w">      </span><span class="c">! *     $              lwork-2*n, ierr )</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                             </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)))</span>
<span class="w">                             </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">)</span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">end do</span>
<span class="k">                       end do</span>
<span class="k">                    end if</span>
<span class="k">                    call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                             </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)))</span>
<span class="w">                             </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                          </span><span class="k">end do</span>
<span class="k">                       end do</span>
<span class="k">                    else</span>
<span class="k">                       call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="w">                    </span><span class="c">! now, compute r2 = l3 * q3, the lq factorization.</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sgelqf</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="c">! And Estimate The Condition Number</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">nr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="o">/</span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    call </span><span class="n">stdlib_spocon</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">nr</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">temp1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">nr</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">iwork</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">condr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr2</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                       </span><span class="c">! Save The Householder Vectors Used For Q3</span>
<span class="w">                       </span><span class="c">! (this overwrites the copy of r2, as it will not be</span>
<span class="w">                       </span><span class="c">! needed in this branch, but it does not overwritte the</span>
<span class="w">                       </span><span class="c">! huseholder vectors of q2.).</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="c">! And The Rest Of The Information On Q3 Is In</span>
<span class="w">                       </span><span class="c">! work(2*n+n*nr+1:2*n+n*nr+n)</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                 end if</span>
<span class="k">                 if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                          </span><span class="c">! v(p,q) = - sign( temp1, v(q,p) )</span>
<span class="w">                          </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                 else</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="w">              </span><span class="c">! second preconditioning finished; continue with jacobi svd</span>
<span class="w">              </span><span class="c">! the input matrix is lower trinagular.</span>
<span class="w">              </span><span class="c">! recover the right singular vectors as solution of a well</span>
<span class="w">              </span><span class="c">! conditioned triangular matrix equation.</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="n">sva</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),&amp;</span>
<span class="w">                              </span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="w">    </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="w">              </span><span class="c">! Pick The Right Matrix Equation And Solve It</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">       </span><span class="c">! :))             .. best case, r1 is inverted. the solution of this matrix</span>
<span class="w">                       </span><span class="c">! equation is q2*v2 = the product of the jacobi rotations</span>
<span class="w">                       </span><span class="c">! used in stdlib_sgesvj, premultiplied with the orthogonal matrix</span>
<span class="w">                       </span><span class="c">! from the second qr factorization.</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_strsm</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">else</span>
<span class="w">                       </span><span class="c">! .. r1 is well conditioned, but non-square. transpose(r2)</span>
<span class="w">                       </span><span class="c">! is inverted to get the product of the jacobi rotations</span>
<span class="w">                       </span><span class="c">! used in stdlib_sgesvj. the q-factor from the second qr</span>
<span class="w">                       </span><span class="c">! factorization is then built in explicitly.</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_strsm</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">)</span>
<span class="w">                       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                         call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="p">)</span>
<span class="w">                         </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="p">)</span>
<span class="w">                         </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="p">)</span>
<span class="w">                       </span><span class="k">end if</span>
<span class="k">                       call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                                 </span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                 else if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">condr2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">cond_ok</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">       </span><span class="c">! :)           .. the input matrix a is very likely a relative of</span>
<span class="w">                    </span><span class="c">! the kahan matrix :)</span>
<span class="w">                    </span><span class="c">! the matrix r2 is inverted. the solution of the matrix equation</span>
<span class="w">                    </span><span class="c">! is q3^t*v3 = the product of the jacobi rotations (appplied to</span>
<span class="w">                    </span><span class="c">! the lower triangular l3 from the lq factorization of</span>
<span class="w">                    </span><span class="c">! r2=l3*q3), pre-multiplied with the transposed q3.</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="w">    </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    call </span><span class="n">stdlib_strsm</span><span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">)</span>
<span class="w">                    </span><span class="c">! Apply The Permutation From The Second Qr Factorization</span>
<span class="w">                    </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">iwork</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                       do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                    if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                    call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">else</span>
<span class="w">                    </span><span class="c">! last line of defense.</span>
<span class="w">       </span><span class="c">! #:(          this is a rather pathological case: no scaled condition</span>
<span class="w">                    </span><span class="c">! improvement after two pivoted qr factorizations. other</span>
<span class="w">                    </span><span class="c">! possibility is that the rank revealing qr factorization</span>
<span class="w">                    </span><span class="c">! or the condition estimator has failed, or the cond_ok</span>
<span class="w">                    </span><span class="c">! is set very close to one (which is unnecessary). normally,</span>
<span class="w">                    </span><span class="c">! this branch should never be executed, but in rare cases of</span>
<span class="w">                    </span><span class="c">! failure of the rrqr or condition estimator, the last line of</span>
<span class="w">                    </span><span class="c">! defense ensures that stdlib_sgejsv completes the task.</span>
<span class="w">                    </span><span class="c">! compute the full svd of l3 using stdlib_sgesvj with explicit</span>
<span class="w">                    </span><span class="c">! accumulation of jacobi rotations.</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                    </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                    call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sormlq</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                       </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">iwork</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                       do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                          </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                 end if</span>
<span class="w">                 </span><span class="c">! permute the rows of v using the (column) permutation from the</span>
<span class="w">                 </span><span class="c">! first qrf. also, scale the columns to make them unit in</span>
<span class="w">                 </span><span class="c">! euclidean norm. this applies to all cases.</span>
<span class="w">                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">epsln</span>
<span class="w">                 </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="w">                 </span><span class="c">! at this moment, v contains the right singular vectors of a.</span>
<span class="w">                 </span><span class="c">! next, assemble the left singular vector matrix u (m x n).</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldu</span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldu</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                 end if</span>
<span class="w">                 </span><span class="c">! the q matrix from the first qrf is built into the left singular</span>
<span class="w">                 </span><span class="c">! matrix u. this applies to all cases.</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LEFT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO_TR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="c">! the columns of u are normalized. the cost is o(m*n) flops.</span>
<span class="w">                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">epsln</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="w">                 </span><span class="c">! if the initial qrf is computed with row pivoting, the left</span>
<span class="w">                 </span><span class="c">! singular vectors must be adjusted.</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_slaswp</span><span class="p">(</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">else</span>
<span class="w">              </span><span class="c">! The Initial Matrix A Has Almost Orthogonal Columns And</span>
<span class="w">              </span><span class="c">! the second qrf is not needed</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                          </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">)</span><span class="o">=-</span><span class="nb">sign</span><span class="p">(</span><span class="n">temp1</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">q</span><span class="p">))</span>
<span class="w">                       </span><span class="k">end do</span>
<span class="k">                    end do</span>
<span class="k">                 else</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LOWER&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">                 call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                           </span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">                 </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 call </span><span class="n">stdlib_strsm</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LEFT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;UPPER&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NOTRANS&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO UD&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="p">&amp;</span>
<span class="w">                           </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">),</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="w">                 </span><span class="c">! assemble the left singular vector matrix u (m x n).</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w">  </span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                       call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="w">  </span><span class="n">n1</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w">  </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end if</span>
<span class="k">                 end if</span>
<span class="k">                 call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LEFT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO TR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                           </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span><span class="o">*</span><span class="n">epsln</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span>
<span class="w">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">                 if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_slaswp</span><span class="p">(</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="w">              </span><span class="c">! end of the  &gt;&gt; almost orthogonal case &lt;&lt;  in the full svd</span>
<span class="w">              </span><span class="k">else</span>
<span class="w">              </span><span class="c">! this branch deploys a preconditioned jacobi svd with explicitly</span>
<span class="w">              </span><span class="c">! accumulated rotations. it is included as optional, mainly for</span>
<span class="w">              </span><span class="c">! experimental purposes. it does perform well, and can also be used.</span>
<span class="w">              </span><span class="c">! in this implementation, this branch will be automatically activated</span>
<span class="w">              </span><span class="c">! if the  condition number sigma_max(a) / sigma_min(a) is predicted</span>
<span class="w">              </span><span class="c">! to be greater than the overflow threshold. this is because the</span>
<span class="w">              </span><span class="c">! a posteriori computation of the singular vectors assumes robust</span>
<span class="w">              </span><span class="c">! implementation of blas and some lapack procedures, capable of working</span>
<span class="w">              </span><span class="c">! in presence of extreme values. since that is not always the case, ...</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">epsln</span><span class="p">)</span>
<span class="w">                 </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                    </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="nb">abs</span><span class="p">(</span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">))</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">temp1</span><span class="w"> </span><span class="p">).</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">)</span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sign</span><span class="p">(&amp;</span>
<span class="w">                                  </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                       </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                 end do</span>
<span class="k">              else</span>
<span class="k">                 call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              call </span><span class="n">stdlib_sgeqrf</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">call </span><span class="n">stdlib_slacpy</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_scopy</span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2pert</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="n">small</span><span class="o">/</span><span class="n">epsln</span><span class="p">)</span>
<span class="w">                 </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span>
<span class="w">                       </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">xsc</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">p</span><span class="p">)),</span><span class="nb">abs</span><span class="p">(</span><span class="n">u</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">q</span><span class="p">)))</span>
<span class="w">                       </span><span class="n">u</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nb">sign</span><span class="p">(</span><span class="w"> </span><span class="n">temp1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                 end do</span>
<span class="k">              else</span>
<span class="k">                 call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              call </span><span class="n">stdlib_sgesvj</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">ldv</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">scalem</span><span class="w">  </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="w">              </span><span class="n">numrank</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">nint</span><span class="p">(</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span><span class="nb">KIND</span><span class="o">=</span><span class="n">ilp</span><span class="p">)</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="n">one</span><span class="p">,</span><span class="n">v</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldv</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">v</span><span class="p">,</span><span class="n">ldv</span><span class="p">,</span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">)&amp;</span>
<span class="w">                        </span><span class="p">,</span><span class="n">lwork</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="c">! permute the rows of v using the (column) permutation from the</span>
<span class="w">                 </span><span class="c">! first qrf. also, scale the columns to make them unit in</span>
<span class="w">                 </span><span class="c">! euclidean norm. this applies to all cases.</span>
<span class="w">                 </span><span class="n">temp1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">sqrt</span><span class="p">(</span><span class="kt">real</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nb">KIND</span><span class="o">=</span><span class="n">sp</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">epsln</span>
<span class="w">                 </span><span class="k">do </span><span class="n">q</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">iwork</span><span class="p">(</span><span class="n">p</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                       </span><span class="n">v</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">q</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="n">n</span><span class="o">*</span><span class="n">nr</span><span class="o">+</span><span class="n">nr</span><span class="o">+</span><span class="n">p</span><span class="p">)</span>
<span class="w">                    </span><span class="k">end do</span>
<span class="k">                    </span><span class="n">xsc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">stdlib_snrm2</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">-</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">.</span><span class="nb">or</span><span class="p">.</span><span class="w"> </span><span class="p">(</span><span class="n">xsc</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">one</span><span class="o">+</span><span class="n">temp1</span><span class="p">))</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_sscal</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">xsc</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                              </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">q</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="w">                 </span><span class="c">! at this moment, v contains the right singular vectors of a.</span>
<span class="w">                 </span><span class="c">! next, assemble the left singular vector matrix u (m x n).</span>
<span class="w">              </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">m</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                 call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="w">  </span><span class="n">m</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">                    call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">nr</span><span class="p">,</span><span class="w">  </span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w">  </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_slaset</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">one</span><span class="p">,</span><span class="n">u</span><span class="p">(</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">ldu</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end if</span>
<span class="k">              end if</span>
<span class="k">              call </span><span class="n">stdlib_sormqr</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;LEFT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NO TR&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">lda</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">                        </span><span class="n">lwork</span><span class="o">-</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">rowpiv</span><span class="w"> </span><span class="p">)</span><span class="k">call </span><span class="n">stdlib_slaswp</span><span class="p">(</span><span class="w"> </span><span class="n">n1</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">,</span><span class="w"> </span><span class="n">ldu</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">m</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="k">end if</span>
<span class="k">              if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">transp</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="w">                 </span><span class="c">! .. swap u and v because the procedure worked on a^t</span>
<span class="w">                 </span><span class="k">do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                    </span><span class="k">call </span><span class="n">stdlib_sswap</span><span class="p">(</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">u</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">p</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
<span class="w">                 </span><span class="k">end do</span>
<span class="k">              end if</span>
<span class="k">           end if</span>
<span class="w">           </span><span class="c">! end of the full svd</span>
<span class="w">           </span><span class="c">! undo scaling, if necessary (and possible)</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">uscal2</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="p">(</span><span class="n">big</span><span class="o">/</span><span class="n">sva</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">uscal1</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              call </span><span class="n">stdlib_slascl</span><span class="p">(</span><span class="w"> </span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">uscal1</span><span class="p">,</span><span class="w"> </span><span class="n">uscal2</span><span class="p">,</span><span class="w"> </span><span class="n">nr</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">sva</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">ierr</span><span class="w"> </span><span class="p">)</span>
<span class="w">              </span><span class="n">uscal1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">              </span><span class="n">uscal2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">one</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">nr</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              do </span><span class="n">p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">n</span>
<span class="w">                 </span><span class="n">sva</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span>
<span class="w">              </span><span class="k">end do</span>
<span class="k">           end if</span>
<span class="k">           </span><span class="n">work</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uscal2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">scalem</span>
<span class="w">           </span><span class="n">work</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">uscal1</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">errest</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="n">work</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sconda</span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">lsvec</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="n">rsvec</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">work</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">condr1</span>
<span class="w">              </span><span class="n">work</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">condr2</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">l2tran</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">              </span><span class="n">work</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entra</span>
<span class="w">              </span><span class="n">work</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entrat</span>
<span class="w">           </span><span class="k">end if</span>
<span class="k">           </span><span class="n">iwork</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nr</span>
<span class="w">           </span><span class="n">iwork</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">numrank</span>
<span class="w">           </span><span class="n">iwork</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">warning</span>
<span class="w">           </span><span class="k">return</span>
<span class="k">     end subroutine </span><span class="n">stdlib_sgejsv</span>
</pre></div>

    </section>
    <br>
    
    </div>
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-6"><p>Fortran-lang/stdlib was developed by fortran-lang/stdlib contributors<br>&copy; 2024 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a>
<br /><small>e88daa3</small></p>
        </div>
        <div class="col-xs-6 col-md-6">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/Fortran-FOSS-Programmers/ford">FORD</a>
 on 2024-04-02 08:24            </p>
        </div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
  </body>
</html>